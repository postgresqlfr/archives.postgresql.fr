
<!DOCTYPE
 html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
 <html>
 <!-- $Date: 2005/08/30 07:54:43 $ / $Revision: 1.29 $ / Last Theme Editor :$Author: jx $-->
  
<!-- Mirrored from drupal.postgresql.fr/?q=node/438 by HTTrack Website Copier/3.x [XR&CO'2006], Sun, 12 Oct 2008 15:57:18 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<base  />
<style type="text/css" media="all">@import "misc/drupal.css";</style>
   <title>Utilisation des r√¥les dans PostgreSQL 8.1 - PostgreSQLFr</title>
 <style type="text/css" media="screen" title="Normal Text">
    @import url("layout/css/blue/fixed.css");
    @import url(_guillaume/dotclear/themes/postgresql/style.html);
 </style>
 <style type="text/css" media="screen" title="Normal Text2">
    @import url("layout/css/blue/pgfr.css");
    @import url(_guillaume/dotclear/themes/postgresql/style.html);
 </style>
   </head>
   <body>
    <table border="0" cellspacing="5" cellpadding="0" width="100%">
     <tr>
      <!--td colspan="2" width="100%"-->
      <td colspan="2">
      <!-- Head -->
       <table border="0" cellspacing="0" cellpadding="0" width="100%">
        <tr>
	 <td align="left">
           <div id="pgHeader">
	    <div id="pgHeaderLogoLeft">
	     <a href="index.html" title="PostgreSQL"><img src="layout/images/hdr_left.png" width="230" height="80" alt="PostgreSQL" /></a>
	    </div>
	    <div id="pgHeaderLogoRight">
	     <a href="index.html" title="La base de donnÈes la plus sophistiquÈe au monde."><img src="layout/images/hdr_right.png" width="210" height="80" alt="La base de donnÈes la plus sophistiquÈe au monde." /></a>
	    </div>
	   </div>
         </td>
	 <td align="right">
         </td>
	</tr>
      </table> <!-- Head -->
      <br />
      <table border="0" cellspacing="0" cellpadding="0" width="100%">
              <tr>
	      	 <td align="left">

		<div class="pgTopNav">
		   <div class="pgTopNavLeft"> 
		     <img src="layout/images/nav_lft.png" width="7" height="23" alt="" />
		   </div>
		   <div class="pgTopNavRight">
		    <img src="layout/images/nav_rgt.png" width="7" height="23" alt="" />
		  </div>
		  <!--<ul class="pgTopNavList">-->
		  <ul class="pgTopNavList">
		   <li><a href="index03d2.html?q=" title="Retourner √† la page principale.">accueil</a> </li>
		   <li> <a href="indexf6e5.html?q=archive" title="Lire le contenu plus ancien dans notre archive.">archives</a> </li>
		   <li> <a href="index71c4.html?q=blog" title="Lire les blogues les plus r√©cents.">blogues</a> </li>

		   <li> <a href="indexf6fe.html?q=book" title="Lire et contribuer aux livres collaboratifs.">livres</a> </li>
		   <li> <a href="index79b7.html?q=forum">forums</a> </li>
		   <li> <a href="index729f.html?q=poll" title="Voir la liste des sondages de ce site.">sondages</a> </li>
		   <li> <a href="index4404.html?q=search" title="Chercher pour du contenu plus vieux.">recherche</a></li><li><a href="http://docs.postgresqlfr.org/" target="_blank">documentation </a></li>

		  </ul>

<!--
		   <li><a href="?q=" title="Retourner √† la page principale.">accueil</a> </li>
		   <li> <a href="?q=archive" title="Lire le contenu plus ancien dans notre archive.">archives</a> </li>
		   <li> <a href="?q=blog" title="Lire les blogues les plus r√©cents.">blogues</a> </li>
		   <li> <a href="?q=book" title="Lire et contribuer aux livres collaboratifs.">livres</a> </li>
		   <li> <a href="?q=forum">forums</a> </li>
		   <li> <a href="?q=poll" title="Voir la liste des sondages de ce site.">sondages</a> </li>
		   <li> <a href="?q=search" title="Chercher pour du contenu plus vieux.">recherche</a></li><li><a href="http://docs.postgresqlfr.org/" target="_blank">documentation </a></li>
-->
		  </ul>
	        </div>
		</td>
		</tr>
		</table>
      </td>
     </tr>
     <tr>
    <td style="vertical-align: top; width: 20%;">
<div class="block block-user" id="block-user-0">
<div class="pgSideNav">    <h2>Ouverture de session</h2>    
		    <div>
			<form action="http://drupal.postgresql.fr/?q=user/login" method="post">
<div class="user-login-block">
<input type="hidden" name="edit[destination]" value="node/438" />
<div class="form-item">
 <label for="edit-name">Nom d'utilisateur:</label><br />
 <input type="text" maxlength="64" class="form-text" name="edit[name]" id="edit-name" size="15" value="" />
</div>
<div class="form-item">
 <label for="edit-pass">Mot de passe:</label><br />
 <input type="password" class="form-password" maxlength="64" name="edit[pass]" id="edit-pass" size="15" value="" />
</div>
<input type="submit" class="form-submit" name="op" value="Identification"  />
</div>

</form>
<div class="item-list"><ul><li><a href="indexc12c.html?q=user/password" title="Demander un nouveau mot de passe par e-mail.">Demander un nouveau mot de passe</a></li></ul></div>
		    </div></div></div>
<div class="block block-user" id="block-user-1">
<div class="pgSideNav">    <h2>Navigation</h2>    
		    <div>
			<div class="menu">
<ul>
<li class="leaf"><a href="indexa499.html?q=tracker">messages r√©cents</a></li>

</ul>
</div>
		    </div></div></div>
<div class="block block-block" id="block-block-4">
<div class="pgSideNav">    <h2>Contactez-nous</h2>    
		    <div>
			<p><strong>Administration du site&nbsp;:</strong><br />
"equipe chez postgresqlfr point org"<br><br />
<strong>Contact presse&nbsp;:</strong><br />
"fr chez postgresql point org"<br><br />
<strong>Contact association&nbsp;:</strong><br />
"bureau chez postgresqlfr point org"<br><br />
<strong>Questions PostgreSQL&nbsp;:</strong><br />
&nbsp;IRC&nbsp;:<br />
&nbsp;&nbsp;serveur <strong>irc.freenode.net</strong><br />
&nbsp;&nbsp;canal <strong>#postgresqlfr</strong></p>

		    </div></div></div>
<div class="block block-block" id="block-block-1">
<div class="pgSideNav">    <h2>Liens</h2>    
		    <div>
			<p><small></p>
<ul>
<li>
<a href="http://www.postgresqlfr.org/?q=node/view/162">Adh√©rer</a>
</li>
<li>
<a href="http://www.postgresqlfr.org/?q=node/473">Faire un don</a>
</li>
<li>
<a href="http://www.postgresqlfr.org/?q=node/163">Consulter les statuts</a>
</li>
</ul>
<ul>
<li>
<a href="http://www.postgresql.org/" class="active">Site original<br />
</a>
</li>
<li>
<a href="http://docs.postgresqlfr.org/" class="active">Site de traduction</a>
</li>
<li>
<a href="http://docs.postgresqlfr.org/8.3/">Doc v.8.3.x fr</a>
</li>
<li>
<a href="http://docs.postgresqlfr.org/8.2/">Doc v.8.2.x fr</a>
</li>
<li>
<a href="http://docs.postgresqlfr.org/8.1/">Doc v.8.1.x fr</a>
</li>
<li>
<a href="http://docs.postgresqlfr.org/8.0/">Doc v.8.0.x fr</a>
</li>
<li>
<a href="http://docs.postgresqlfr.org/7.4/">Doc v.7.4.x fr</a>
</li>
<li>
<a href="http://www.postgis.fr/">PostGIS</a>
</li>
<li>
<a href="http://www.postgresql.org/docs/techdocs">Techdocs</a>
</li>
<li>
<a href="http://www.varlena.com/varlena/GeneralBits/Tidbits/">General TidBits</a>
</li>
<p><!--</p>
<li>
<a href="http://www.postgresqlfr.org/?q=node/view/58">Version Windows</a>
</li>
<p>--></p>
<li>
<a href="http://www.postgresqlfr.org/drupal/?q=node/view/63">T√©moignages de pros</a>
</li>
<li>
<a href="http://archives.postgresql.org/pgsql-fr-generale/">Liste de diffusion</a>
</li>
<li>
<a href="http://wwwmaster.postgresql.org/download/mirrors-ftp">T√©l√©charger</a>
</li>
</ul>
<p></small></p>

		    </div></div></div>
<div class="block block-block" id="block-block-2">
<div class="pgSideNav">    <h2>Recherche</h2>    
		    <div>
			<form action="http://drupal.postgresql.fr/?q=search" method="post">
<div id="search">
<input class="form-text" type="text" size="15" value="" name="keys" alt="Enter the terms you wish to search for." /><br />
<input class="form-submit" type="submit" value="Recherche" />
</div>
</form>

		    </div></div></div>
<div class="block block-forum" id="block-forum-0">
<div class="pgSideNav">    <h2>Sujets du forum</h2>    
		    <div>
			<div class="item-list"><h3>Sujets actifs</h3><ul><li><a href="index253f.html?q=node/1742">A LIRE : FERMETURE DES FORUMS DRUPAL</a></li><li><a href="indexfc2e.html?q=node/1739" title="2 commentaires">Probl√®me  avec pg_dump</a></li><li><a href="index97c1.html?q=node/1731" title="5 commentaires">Connexions simultann√©es</a></li><li><a href="index32d3.html?q=node/1737" title="1 commentaire">Optimisation de la m√©moire sous PostgreSQL</a></li><li><a href="index2483.html?q=node/1736" title="3 commentaires">[R√©solu] Upgrade Postgre -> types et op√©rateurs</a></li></ul></div><div class="item-list"><h3>Nouveaux sujets:</h3><ul><li><a href="index253f.html?q=node/1742">A LIRE : FERMETURE DES FORUMS DRUPAL</a></li><li><a href="indexfc2e.html?q=node/1739" title="2 commentaires">Probl√®me  avec pg_dump</a></li><li><a href="index32d3.html?q=node/1737" title="1 commentaire">Optimisation de la m√©moire sous PostgreSQL</a></li><li><a href="index2483.html?q=node/1736" title="3 commentaires">[R√©solu] Upgrade Postgre -> types et op√©rateurs</a></li><li><a href="index82c4.html?q=node/1734" title="2 commentaires">[RESOLU] Probleme de connection en odbc</a></li></ul></div><div class="more-link"><a href="index79b7.html?q=forum" title="Lire les derniers sujets.">en lire plus</a></div>
		    </div></div></div>
<div class="block block-archive" id="block-archive-0">
<div class="pgSideNav">    <h2>Acc√©der aux archives</h2>    
		    <div>
			
<!-- calendar -->
<div class="calendar"><table summary="Un calendrier pour acc√©der aux archives.">
 <caption><a href="index9dfb.html?q=archive/2008/09/12" title="Mois pr√©c√©dent">&laquo;</a> Octobre 2008 &nbsp;</caption>
 <tr class="header-week">
 <th abbr="Lundi">Lun</th>
 <th abbr="Mardi">Mar</th>
 <th abbr="Mercredi">Mer</th>
 <th abbr="Jeudi">Jeu</th>
 <th abbr="Vendredi">Ven</th>
 <th abbr="Samedi">Sam</th>
 <th abbr="Dimanche">Dim</th>
</tr>
 <tr class="row-week"><td class="day-blank" colspan="2">&nbsp;</td>
  <td class="day-link"><a href="indexd3e2.html?q=archive/2008/10/1">1</a></td>
  <td class="day-normal">2</td>
  <td class="day-normal">3</td>
  <td class="day-normal">4</td>
  <td class="day-normal">5</td>
 </tr>
 <tr class="row-week">
  <td class="day-normal">6</td>
  <td class="day-normal">7</td>
  <td class="day-normal">8</td>
  <td class="day-normal">9</td>
  <td class="day-normal">10</td>
  <td class="day-normal">11</td>
  <td class="day-today">12</td>
 </tr>
 <tr class="row-week">
  <td class="day-future">13</td>
  <td class="day-future">14</td>
  <td class="day-future">15</td>
  <td class="day-future">16</td>
  <td class="day-future">17</td>
  <td class="day-future">18</td>
  <td class="day-future">19</td>
 </tr>
 <tr class="row-week">
  <td class="day-future">20</td>
  <td class="day-future">21</td>
  <td class="day-future">22</td>
  <td class="day-future">23</td>
  <td class="day-future">24</td>
  <td class="day-future">25</td>
  <td class="day-future">26</td>
 </tr>
 <tr class="row-week">
  <td class="day-future">27</td>
  <td class="day-future">28</td>
  <td class="day-future">29</td>
  <td class="day-future">30</td>
  <td class="day-future">31</td>
  <td class="day-blank" colspan="2">&nbsp;</td>
 </tr>
</table></div>


		    </div></div></div>
<div class="block block-node" id="block-node-0">
<div class="pgSideNav">    <h2>Syndication</h2>    
		    <div>
			<div class="xml-icon"><a href="index9637.html?q=rss.xml"><img src="misc/xml.png" width="36" height="14" alt="Flux XML" title="Flux XML" /></a></div>
		    </div></div></div>
<div class="block block-poll" id="block-poll-0">
<div class="pgSideNav">    <h2>Sondage</h2>    
		    <div>
			<div class="poll"><div class="title">Quelle est la version de PostgreSQL la plus r√©pandue sur vos serveurs ?</div><div class="text">8.3</div><div class="bar"><div style="width: 10%;" class="foreground"></div></div><div class="percent">10%</div><div class="text">8.2</div><div class="bar"><div style="width: 42%;" class="foreground"></div></div><div class="percent">42%</div><div class="text">8.1</div><div class="bar"><div style="width: 40%;" class="foreground"></div></div><div class="percent">40%</div><div class="text">8.0</div><div class="bar"><div style="width: 2%;" class="foreground"></div></div><div class="percent">2%</div><div class="text">7.4</div><div class="bar"><div style="width: 6%;" class="foreground"></div></div><div class="percent">6%</div><div class="text">7.3 ou ant√©rieure</div><div class="bar"><div style="width: 0%;" class="foreground"></div></div><div class="percent">0%</div><div class="total">Nombre de votes: 48</div></div><div class="links"><a href="index8c57.html?q=node/1426#comment" title="Sauter au premier commentaire de ce message.">3 commentaires</a> | <a href="index729f.html?q=poll" title="Voir la liste des sondages de ce site.">anciens sondages</a></div>
		    </div></div></div>
    </td>

      <td style="vertical-align: top; width: 80%"><div class="breadcrumb"><a href="index03d2.html?q=">Accueil</a></div><h2 class="title">Utilisation des r√¥les dans PostgreSQL 8.1</h2>
<!-- begin content -->

<!-- node: "Utilisation des r√¥les dans PostgreSQL 8.1" -->
<!--<div class="pgFrontCenterUser">
<div class="pgFrontUser">
<div class="pgFrontUserInner">
--><div class="pgFrontUserWrap">
 <div class="pgFrontUserContent">	<h1 class="plop"><a href="index8ccf.html?q=taxonomy/term/1">Technique</a> | <a href="index0028.html?q=node/438" class="active">Utilisation des r√¥les dans PostgreSQL 8.1</a></h1>
		    <p>
			    Par <a href="indexc818.html?q=user/3" title="Voir le profil utilisateur.">Guillaume Lelarge</a> le 29/11/2005 - 18:56
		    </p>	
			    <p>Ce document est un rappel de l'utilisation des utilisateurs et groupes pour les versions ant√©rieures √† la 8.1 et une introduction aux r√¥les, concept rempla√ßant les utilisateurs/groupes √† partir de PostgreSQL 8.1.</p>
<p><!-- header --></p>
<p>PostgreSQL 8.1 modifie la gestion des utilisateurs. Le concept des utilisateurs et des groupes est remplac√© par un concept plus global&nbsp;: celui des <a href="http://traduc.postgresqlfr.org/pgsql-8.1.0-fr/user-manag.html">r√¥les</a>. Un r√¥le correspond √† un utilisateur et/ou √† un groupe. Un r√¥le a des droits et il peut √™tre membre d'un ou plusieurs autres r√¥les.</p>
<p>Le concept des utilisateurs et des groupes est facile √† appr√©hender. Malheureusement, il ne donne pas beaucoup de libert√© dans son utilisation. Un utilisateur fait partie d'un ou plusieurs groupes. Il h√©rite en cela des droits de ces groupes. √Ä partir du moment o√π un utilisateur fait partie d'un groupe, il dispose des droits de ce groupe. Il lui est impossible de masquer les droits du groupe pour ne voir que les siens. Il lui est aussi impossible de masquer ses droits par ceux du groupe. Les r√¥les permettent tout cela.</p>
<p>√Ä sa cr√©ation, un r√¥le peut avoir <a href="http://traduc.postgresqlfr.org/pgsql-8.1.0-fr/role-attributes.html">plusieurs options sp√©ciales</a>&nbsp;:</p>
<ul>
<li>login, le r√¥le est autoris√© √† se connecter sur une base</li>
<li>createdb, le r√¥le est autoris√© √† cr√©er une base de donn√©es</li>
<li>createrole, le r√¥le est autoris√© √† cr√©er un autre r√¥le</li>
<li>superuser, le r√¥le a tous les droits car il est un superutilisateur</li>
</ul>
<p>Tout de suite, nous apercevons une diff√©rence importante avec les versions pr√©c√©dentes. Un r√¥le pouvant cr√©er un autre r√¥le n'est pas forc√©ment un superutilisateur. Pour qu'un r√¥le soit superutilisateur, il doit avoir √©t√© cr√©√© avec l'option superuser par un superutilisateur. Cela sous-entend un point extr√™mement important pour l'administration d'un serveur de bases de donn√©es : il est maintenant possible de nommer un administrateur, charg√© de la cr√©ation des bases et des r√¥les, qui ne soit pas malgr√© tout le ma√Ætre absolu du SGBD. Certes, il pourra cr√©er des bases mais cela ne lui donnera pas le droit de supprimer objets et donn√©es dans cette base (en supposant qu'un autre r√¥le soit le propri√©taire de la base). Nous verrons plus tard que les r√¥les permettent une meilleure prise en compte de la s√©curit√©.</p>
<p>Une fois un r√¥le cr√©√©, il est possible de le rendre propri√©taire d'objets et de lui donner/enlever des droits sur les objets. Pour cela, vous disposez des instructions SQL habituelles : ALTER objet SET OWNER / <a href="http://traduc.postgresqlfr.org/pgsql-8.1.0-fr/sql-grant.html">GRANT</a> / <a href="http://traduc.postgresqlfr.org/pgsql-8.1.0-fr/sql-revoke.html">REVOKE</a>. Vous pouvez int√©grer un r√¥le √† un autre avec la commande <a href="http://traduc.postgresqlfr.org/pgsql-8.1.0-fr/sql-altergroup.html">ALTER GROUP groupe ADD USER utilisateur</a>. Tout cela ressemble aux versions pr√©c√©dentes de PostgreSQL&nbsp;: il existe des utilisateurs (r√¥les ayant le doit LOGIN) et des groupes (r√¥les comprenants d'autres r√¥les comme membres).</p>
<p>Passons √† la pratique avec un exemple simple. Mettons-nous dans le cas d'une entreprise stockant ces factures dans une base de donn√©es PostgreSQL. Lors de la conception du sch√©ma de cette base, une table contenant les factures a √©t√© cr√©√©e&nbsp;:</p>
<pre>postgres@metier=# CREATE TABLE facture (f_id int4, f_objet varchar(200));</pre>
<p>Les droits relatifs aux personnes du service secr√©tariat sont g√©r√©s gr√¢ce √† un r√¥le nomm√© secr√©tariat.</p>
<pre>postgres@metier=# CREATE ROLE secretariat;</pre>
<p>Anne fait partie du secr√©tariat et doit √™tre ajout√©e √† ce groupe&nbsp;:</p>
<pre>postgres@metier=# CREATE ROLE anne LOGIN IN GROUP SECRETARIAT;</pre>
<p>Ce groupe a le droit de visualiser, d'ajouter et de mettre √† jour des factures. √âtant pour l'instant la seule de ce service, elle aura aussi le droit de supprimer des factures erron√©es.</p>
<pre>postgres@metier=# GRANT SELECT, INSERT, UPDATE, DELETE ON facture TO secretariat;</pre>
<p>Connectons-nous en tant que anne&nbsp;:</p>
<pre>bash# psql -U anne metier</pre>
<p>Et ins√©rons une facture&nbsp;:</p>
<pre>anne@metier=> insert into facture (f_id, f_objet) values (1, 'PostgreSQL par la pratique');<br />
INSERT 0 1<br />
anne@metier=>select * from facture;<br />
 f_id | f_objet<br />
------+---------<br />
    1 | PostgreSQL par la pratique<br />
(1 ligne)</p>
<p>anne@metier=>insert into facture (f_id, f_objet) values (2, 'Cahiers du Programmeur PostgreSQL');<br />
INSERT 0 1<br />
anne@metier=>select * from facture;<br />
 f_id | f_objet<br />
------+---------<br />
    1 | PostgreSQL par la pratique<br />
    2 | Cahiers du Programmeur PostgreSQL<br />
(2 lignes)</p>
<p>anne@metier=>delete from facture where f_id=1;<br />
DELETE 1<br />
anne@metier=>select * from facture;<br />
 f_id | f_objet<br />
------+---------<br />
    2 | Cahiers du Programmeur PostgreSQL<br />
(1 ligne)</pre>
<p>Apr√®s quelques op√©rations, nous nous apercevons que le r√¥le est bien param√©tr√©.</p>
<p>Tr√®s bien. Jusque-l√†, ce n'est qu'une simple utilisation des r√¥les, identique √† ce qu'il √©tait possible de faire avec les utilisateurs et groupes de la version pr√©c√©dente.</p>
<p>Une nouvelle personne est embauch√©e au service du secr√©tariat. Cette nouvelle personne n'aura pas le droit de supprimer de factures, √©tant donn√© qu'elle vient tout juste d'arriver dans le service. Nous allons donc cr√©er un r√¥le d'administrateur des factures qui ne pourra que supprimer une facture.</p>
<p>Commen√ßons par cr√©er le r√¥le d'administrateur des factures et donnons lui les droits de suppression sur la table facture.</p>
<pre>postgres@metier=# CREATE ROLE admin_secretariat;<br />
CREATE<br />
postgres@metier=# GRANT DELETE ON facture TO admin_secretariat;<br />
GRANT</pre>
<p>Supprimons le droit de suppression du groupe secr√©tariat&nbsp;:</p>
<pre>postgres@metier=# REVOKE DELETE ON facture FROM secretariat;<br />
REVOKE</pre>
<p>Cr√©ons la nouvelle personne et ajoutons-l√† dans le groupe secretariat&nbsp;:</p>
<pre>postgres@metier=# CREATE ROLE beatrice LOGIN IN ROLE secretariat;<br />
CREATE</pre>
<p>N'oublions pas d'ajouter Anne dans le nouveau r√¥le d'administrateur des factures.</p>
<pre>postgres@metier=# GRANT admin_secretariat TO anne;<br />
GRANT</pre>
<p>Testons nos modifications&nbsp;:</p>
<pre>postgres@metier=#\c metier beatrice<br />
Vous √™tes maintenant connect√© √† la base de donn√©es ¬´metier¬ª en tant qu'utilisateur ¬´beatrice¬ª.<br />
beatrice@metier=>insert into facture (f_id, f_objet) values (3, 'PostgreSQL Essential References');<br />
INSERT 0 1<br />
beatrice@metier=>update facture set f_objet='PostgreSQL Essential Reference' where f_id=3;<br />
UPDATE 1<br />
beatrice@metier=>delete from facture where f_id=3;<br />
ERREUR:  droit refus√© pour la relation facture<br />
beatrice@metier=>\c metier anne<br />
Vous √™tes maintenant connect√© √† la base de donn√©es ¬´metier¬ª en tant qu'utilisateur ¬´anne¬ª.<br />
anne@metier=>insert into facture (f_id, f_objet) values (4, 'PostgreSQL Essential Reference');<br />
INSERT 0 1<br />
anne@metier=>update facture set f_objet='objet 4.5' where f_id=4;<br />
UPDATE 1<br />
anne@metier=>delete from facture where f_id=4;<br />
DELETE 1</pre>
<p>Tout va bien. Bien qu'un peu plus complexe, cela √©tait d√©j√† possible avec les anciennes versions. Passons maintenant √† la notion d'h√©ritages direct et indirect. Dans ces exemples, tout utilisateur qui se connectait avait directement les droits qui lui √©taient propres et ceux qu'il h√©ritait des groupes dont il √©tait membre. Supposons que l'administrateur de la base de donn√©es g√®re correctement sa base. Il ne se connecte pas en superutilisateur en permanence, mais uniquement quand les circonstances l'exigent. Anne absente, il doit pouvoir supprimer une facture si le cas se pr√©sente sans pour autant avoir √† d√©gainer les super-pouvoirs du superutilisateur. Solution simple : il va devenir membre du groupe admin_secretariat. Il n'a pas besoin d'avoir le droit de cr√©er ou modifier les factures, simplement de pouvoir les supprimer. Si nous l'ajoutons directement dans ce groupe, d√®s sa connexion, il aura le droit de supprimer des factures. Or, ce n'est pas un travail qu'il va faire fr√©quemment. Il ne faut donc pas que ce droit de suppression soit automatique. Son utilisateur sera donc d√©clar√© comme ne b√©n√©ficiant pas directement des droits des groupes dont il est membre. Supposons que le r√¥le de cet administrateur s'appelle admin_metier... voici sa d√©finition&nbsp;:</p>
<pre>postgres@metier=# CREATE ROLE admin_metier LOGIN NOINHERIT;<br />
CREATE<br />
postgres@metier=# GRANT admin_secretariat TO admin_metier;<br />
GRANT</pre>
<p>Connectons-nous en tant qu'admin_metier et voyons quelles op√©rations sont autoris√©es sur la table facture&nbsp;:</p>
<pre>postgres@metier=#\c metier admin_metier<br />
Vous √™tes maintenant connect√© √† la base de donn√©es ¬´metier¬ª en tant qu'utilisateur ¬´admin_metier¬ª.<br />
admin_metier@metier=>insert into facture (f_id, f_objet) values (5, 'PostgreSQL 8 et PHP 5');<br />
ERREUR:  droit refus√© pour la relation facture<br />
admin_metier@metier=>update facture set f_objet='objet 4.5' where f_id=4;<br />
ERREUR:  droit refus√© pour la relation facture<br />
admin_metier@metier=>delete from facture where f_id=4;<br />
ERREUR:  droit refus√© pour la relation facture</pre>
<p>Les trois op√©rations de base nous sont refus√©es alors que seule DELETE devait fonctionner. Voyons pourquoi.</p>
<pre>admin_metier@metier=>\dp<br />
                                      Privil√®ges d'acc√®s de la base de donn√©es ¬´metier¬ª<br />
 Sch√©ma |       Nom        |   Type   |                                  Privil√®ges d'acc√®s<br />
--------+------------------+----------+---------------------------------------------------------------------------------------<br />
 public | facture          | table    | {postgres=arwdRxt/postgres,secretariat=arw/postgres,admin_secretariat=d/postgres}<br />
(1 ligne)</pre>
<p>La colonne ¬´&nbsp;Privil√®ges d'acc√®s&nbsp;¬ª contient un tableau dont chaque √©l√©ment pr√©cise les droits attribu√©s √† un r√¥le ainsi que le r√¥le qui a attribu√© ces droits. Par exemple, le premier √©l√©ment indique que le r√¥le postgres a re√ßu les droits ¬´&nbsp;arwdRxt&nbsp;¬ª (plus pr√©cis√©ment tous les droits) de lui-m√™me (normal car c'est le superutilisateur de cette base). Le deuxi√®me √©l√©ment indique que le r√¥le secretariat a re√ßu les droits ¬´&nbsp;arw&nbsp;¬ª de l'utilisateur postgres. Voici un petit tableau rappelant la signification de chaque lettre (pour plus d'information, voir la <a href="http://traduc.postgresqlfr.org/pgsql-8.1.0-fr/sql-grant.html">page de manuel sur la commande GRANT</a>)&nbsp;:</p>
<table>
<tr>
<td>r</td>
<td>SELECT</td>
</tr>
<tr>
<td>w</td>
<td>UPDATE</td>
</tr>
<tr>
<td>a</td>
<td>INSERT</td>
</tr>
<tr>
<td>R</td>
<td>RULE</td>
</tr>
<tr>
<td>x</td>
<td>REFERENCES</td>
</tr>
<tr>
<td>r</td>
<td>TRIGGER</td>
</tr>
<tr>
<td>X</td>
<td>EXECUTE</td>
</tr>
<tr>
<td>U</td>
<td>USAGE</td>
</tr>
<tr>
<td>C</td>
<td>CREATE</td>
</tr>
<tr>
<td>T</td>
<td>TEMPORARY</td>
</tr>
</table>
<p>admin_secretariat ne dispose que du droit de suppression (<code>d</code>). Or, nous demandons dans la requ√™te de supprimer toutes les lignes dont f_id vaut 4. Pour cela, nous devons pouvoir lire cette table. Donnons donc le droit de lire (<code>r</code>) cette table au r√¥le admin_secretariat.</p>
<pre>admin_metier@metier=>\c metier postgres<br />
Vous √™tes maintenant connect√© √† la base de donn√©es ¬´metier¬ª en tant qu'utilisateur ¬´postgres¬ª.<br />
postgres@metier=#grant select on facture to admin_secretariat;<br />
GRANT<br />
postgres@metier=#\c metier admin_metier<br />
Vous √™tes maintenant connect√© √† la base de donn√©es ¬´metier¬ª en tant qu'utilisateur ¬´admin_metier¬ª.<br />
admin_metier@metier=>delete from facture where f_id=5;<br />
ERREUR:  droit refus√© pour la relation facture<br />
admin_metier@metier=>set role admin_secretariat;<br />
SET<br />
admin_metier@metier=>delete from facture where f_id=3;<br />
DELETE 1</pre>
<p>Tout fonctionne maintenant √† merveille. L'administrateur de la base n'a pas automatiquement les droits associ√©s aux r√¥les dont il est membre. C'est une grande am√©lioration dans la gestion des droits des utilisateurs et groupes de la base de donn√©es car elle permet de mieux prot√©ger les donn√©es.</p>
<p>Abordons maintenant deux fonctionnalit√©s peu connues mais tr√®s int√©ressantes. Le fichier .psqlrc permet de configurer certains param√®tres en ex√©cution au lancement de psql. Ce fichier est tr√®s utile quand un utilisateur souhaite param√®trer finement sa connexion suivant son travail. Malheureusement, cela ne fonctionne que pour le programme psql. En utilisant d'autres outils, il faudra que ces derniers fournissent un moyen √©quivalent... ce qui ne sera pas toujours le cas. Sachez donc qu'il est aussi possible d'enregistrer les valeurs de certains param√®tres directement au niveau des r√¥les... donc des valeurs appliqu√©es quelque soit l'outil utilis√© pour acc√©der √† la base. Pour cela, il faut utiliser la commande&nbsp;: <a href="http://traduc.postgresqlfr.org/pgsql-8.1.0-fr/sql-alterrole.html">ALTER ROLE toto SET param√®tre TO valeur</a>. L'utilisation la plus fr√©quente est l'initialisation du chemin <a href="http://traduc.postgresqlfr.org/pgsql-8.1.0-fr/runtime-config-client.html#GUC-SEARCH-PATH">search_path</a>.</p>
<p>La deuxi√®me fonctionnalit√© est une nouveaut√© de la 8.1. Il est possible de limiter le nombre de connexions simultan√©es avec un m√™me utilisateur. Il faut voir cela surtout comme une mesure de s√©curit√©. Si vos utilisateurs correspondent r√©ellement √† des personnes physiques, il y a de fortes chances pour qu'elles ne se connectent qu'une fois √† un moment donn√© sur la base. Limiter son nombre d'acc√®s simultan√© permet de pr√©venir des attaques de type DDOS.</p>
<p>Nous terminerons sur une question fr√©quemment pos√©e : comment attribuer un droit √† un r√¥le sur plusieurs objets en m√™me temps. Cela n'est pas possible en SQL avec PostgreSQL. Le mieux revient √† √©crire un script shell qui cr√©era le script SQL √† ex√©cuter. Disons que nous voulons donner un droit particulier √† un utilisateur pour toutes les tables de la base m√©tier. Pour cela, nous utilisons psql avec l'option -c&nbsp;:</p>
<pre>$psql -c "\dt" metier<br />
                Liste des relations<br />
 Sch√©ma  |     Nom     | Type  | Propri√©taire<br />
---------+-------------+-------+---------------<br />
 public  | facture     | table | postgres<br />
 public  | fournisseur | table | postgres<br />
 public  | client      | table | postgres<br />
(3 lignes)</pre>
<p>Nous n'avons pas besoin de l'ent√™te et du bas de page. Il faut utiliser l'option -t pour les supprimer&nbsp;:</p>
<pre>$ psql -t -c "\dt" galette<br />
 public  | facture     | table | postgres<br />
 public  | fournisseur | table | postgres<br />
 public  | client      | table | postgres</pre>
<p>Le c√¥t√© joliment affich√© et les caract√®res | nous posent probl√®me... il serait pr√©f√©rable d'avoir les diff√©rents champs s√©par√©s uniquement par un espace chacun&nbsp;:</p>
<pre>$ psql -F " " -A -t -c "\dt" galette<br />
public facture table postgres<br />
public fournisseur table postgres<br />
public client table postgres</pre>
<p>Seul le nom de la table nous int√©resse sur chaque ligne, donc nous allons utiliser l'outil awk pour r√©cup√©rer le deuxi√®me champ&nbsp;:</p>
<pre>$ psql -F " " -A -t -c "\dt" galette | awk '{ print $2; }'<br />
facture<br />
fournisseur<br />
client</pre>
<p>Enfin, nous utiliserons une boucle pour afficher la commande SQL grant pour chaque table&nbsp;:</p>
<pre>psql -c "\dt" -A -t -F " " ma_base | awk '{ print $2; }' | while read ma_table<br />
do<br />
  echo "GRANT liste_droits ON $ma_table TO mon_role;"<br />
done | psql ma_base</pre>
<p>Il est n√©cessaire de remplacer ma_base par le nom de la base impact√©e, et mon_role par le r√¥le devant avoir les nouveaux droits faisant partie de liste_droits.</p>
<p>Voil√†, j'esp√®re que cet article vous a int√©ress√©. D'autres devraient suivre sur les nouveaut√©s de PostgreSQL 8.1.</p>

		     </div></div>
<!--</div>
</div>
</div>
</div> -->
<a id="comment"></a>
<form method="post" action="http://drupal.postgresql.fr/?q=comment"><div>
<div class="pgSideNav">    <h2>Options d'affichage des commentaires</h2>    
		    <div>
			<div class="form-item">
 <select name="mode"> <option value="1">A plat - repli√©</option>
 <option value="2">A plat - d√©pli√©</option>
 <option value="3">Par discussions - repli√©</option>
 <option value="4" selected="selected">Par discussions - d√©pli√©</option>
</select>
<select name="order"> <option value="1">Date - r√©cents en premier</option>
 <option value="2" selected="selected">Date - anciens en premier</option>
</select>
<select name="comments_per_page"> <option value="10">10 commentaires par page</option> <option value="30">30 commentaires par page</option> <option value="50" selected="selected">50 commentaires par page</option> <option value="70">70 commentaires par page</option> <option value="90">90 commentaires par page</option></select>
<input type="hidden" name="threshold" value="0" />
 <input type="submit" class="form-submit" name="op" value="Sauvegarder les param√®tres"  />

 <div class="description">S√©lectionnez la m√©thode d'affichage des commentaires que vous pr√©f√©rez, puis cliquez sur "Sauvegarder les param√®tres" pour activer vos changements.</div>
</div>

		    </div></div><input type="hidden" name="edit[nid]" value="438" />
</div></form><form method="post" action="http://drupal.postgresql.fr/?q=comment"><div>
<input type="hidden" name="edit[nid]" value="438" />
<a id="comment-527"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">Merci pour cet article fort i</h1>
		<p>
		    <b><a href="index49d4.html?q=user/435" title="Voir le profil utilisateur.">greg1</a></b>/ = 2 D√©cembre, 2005 - 00:57
		</p>
		<p>
		    <p>Merci pour cet article fort int√©ressant.</p>
<p>En ce qui concerne le superutilisateur, j'aurais juste ajout√© qu'√† la diff√©rence d'un utilisateur avec les options CREATEDB et CREATEROLE, il passe outre des droits et des propri√©taires des objets et peut donc agir sur l'ensemble des objets et des bases.</p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div><a id="comment-1685"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">Excellent</h1>
		<p>
		    <b><a href="indexfed9.html?q=user/2279" title="Voir le profil utilisateur.">Alexandre T</a></b>/ = 23 F√©vrier, 2007 - 20:26
		</p>
		<p>
		    <p>Merci pour cet excellent exemple. </p>
<p>Je cherchais depuis un moment comment donner le droit de manipuler les donn√©es de toutes les tables (avec des * ou des *.* comme dans ls autres langages).</p>
<p>Au moins je sais d√©sormais que c'est impossible sans une routine.</p>
<p>Merci.</p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div></div></form>
<!-- end content -->
              </td>

    </tr>
    <tr><td colspan="2">

		<div class="pgTopNav">
		   <div class="pgTopNavLeft"> 
		     <img src="layout/images/nav_lft.png" width="7" height="23" alt="" />
		   </div>
		   <div class="pgTopNavRight">
		    <img src="layout/images/nav_rgt.png" width="7" height="23" alt="" />
		  </div>
		  <!--<ul class="pgTopNavList">-->
		  <ul class="pgTopNavList">
		   <li><a href="index03d2.html?q=" title="Retourner √† la page principale.">accueil</a> </li>
		   <li> <a href="indexf6e5.html?q=archive" title="Lire le contenu plus ancien dans notre archive.">archives</a> </li>
		   <li> <a href="index71c4.html?q=blog" title="Lire les blogues les plus r√©cents.">blogues</a> </li>

		   <li> <a href="indexf6fe.html?q=book" title="Lire et contribuer aux livres collaboratifs.">livres</a> </li>
		   <li> <a href="index79b7.html?q=forum">forums</a> </li>
		   <li> <a href="index729f.html?q=poll" title="Voir la liste des sondages de ce site.">sondages</a> </li>
		   <li> <a href="index4404.html?q=search" title="Chercher pour du contenu plus vieux.">recherche</a></li><li><a href="http://docs.postgresqlfr.org/" target="_blank">documentation </a></li>

		  </ul>

<!--
		   <li><a href="?q=" title="Retourner √† la page principale.">accueil</a> </li>
		   <li> <a href="?q=archive" title="Lire le contenu plus ancien dans notre archive.">archives</a> </li>
		   <li> <a href="?q=blog" title="Lire les blogues les plus r√©cents.">blogues</a> </li>
		   <li> <a href="?q=book" title="Lire et contribuer aux livres collaboratifs.">livres</a> </li>
		   <li> <a href="?q=forum">forums</a> </li>
		   <li> <a href="?q=poll" title="Voir la liste des sondages de ce site.">sondages</a> </li>
		   <li> <a href="?q=search" title="Chercher pour du contenu plus vieux.">recherche</a></li><li><a href="http://docs.postgresqlfr.org/" target="_blank">documentation </a></li>
-->
		  </ul>
	        </div>
    </td></tr>
   </table>
   <p style="text-align: center;">&copy;&nbsp;PostgreSQLFr, tous droits r√©serv√©s.<br>
Site d√©clar√© √† la CNIL sous le num√©ro 1074678, conform√©ment √† la Loi en vigueur.
</p>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-3921927-1");
pageTracker._initData();
pageTracker._trackPageview();
</script>
<p></p>
   
</body>

<!-- Mirrored from drupal.postgresql.fr/?q=node/438 by HTTrack Website Copier/3.x [XR&CO'2006], Sun, 12 Oct 2008 15:57:18 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>