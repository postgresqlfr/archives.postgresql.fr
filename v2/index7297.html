
<!DOCTYPE
 html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
 <html>
 <!-- $Date: 2005/08/30 07:54:43 $ / $Revision: 1.29 $ / Last Theme Editor :$Author: jx $-->
  
<!-- Mirrored from drupal.postgresql.fr/?q=node/1463 by HTTrack Website Copier/3.x [XR&CO'2006], Sun, 12 Oct 2008 16:59:45 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<base  />
<style type="text/css" media="all">@import "misc/drupal.css";</style>
   <title>fonction postgresql - PostgreSQLFr</title>
 <style type="text/css" media="screen" title="Normal Text">
    @import url("layout/css/blue/fixed.css");
    @import url(_guillaume/dotclear/themes/postgresql/style.html);
 </style>
 <style type="text/css" media="screen" title="Normal Text2">
    @import url("layout/css/blue/pgfr.css");
    @import url(_guillaume/dotclear/themes/postgresql/style.html);
 </style>
   </head>
   <body>
    <table border="0" cellspacing="5" cellpadding="0" width="100%">
     <tr>
      <!--td colspan="2" width="100%"-->
      <td colspan="2">
      <!-- Head -->
       <table border="0" cellspacing="0" cellpadding="0" width="100%">
        <tr>
	 <td align="left">
           <div id="pgHeader">
	    <div id="pgHeaderLogoLeft">
	     <a href="index.html" title="PostgreSQL"><img src="layout/images/hdr_left.png" width="230" height="80" alt="PostgreSQL" /></a>
	    </div>
	    <div id="pgHeaderLogoRight">
	     <a href="index.html" title="La base de donnÈes la plus sophistiquÈe au monde."><img src="layout/images/hdr_right.png" width="210" height="80" alt="La base de donnÈes la plus sophistiquÈe au monde." /></a>
	    </div>
	   </div>
         </td>
	 <td align="right">
         </td>
	</tr>
      </table> <!-- Head -->
      <br />
      <table border="0" cellspacing="0" cellpadding="0" width="100%">
              <tr>
	      	 <td align="left">

		<div class="pgTopNav">
		   <div class="pgTopNavLeft"> 
		     <img src="layout/images/nav_lft.png" width="7" height="23" alt="" />
		   </div>
		   <div class="pgTopNavRight">
		    <img src="layout/images/nav_rgt.png" width="7" height="23" alt="" />
		  </div>
		  <!--<ul class="pgTopNavList">-->
		  <ul class="pgTopNavList">
		   <li><a href="index03d2.html?q=" title="Retourner √† la page principale.">accueil</a> </li>
		   <li> <a href="indexf6e5.html?q=archive" title="Lire le contenu plus ancien dans notre archive.">archives</a> </li>
		   <li> <a href="index71c4.html?q=blog" title="Lire les blogues les plus r√©cents.">blogues</a> </li>

		   <li> <a href="indexf6fe.html?q=book" title="Lire et contribuer aux livres collaboratifs.">livres</a> </li>
		   <li> <a href="index79b7.html?q=forum">forums</a> </li>
		   <li> <a href="index729f.html?q=poll" title="Voir la liste des sondages de ce site.">sondages</a> </li>
		   <li> <a href="index4404.html?q=search" title="Chercher pour du contenu plus vieux.">recherche</a></li><li><a href="http://docs.postgresqlfr.org/" target="_blank">documentation </a></li>

		  </ul>

<!--
		   <li><a href="?q=" title="Retourner √† la page principale.">accueil</a> </li>
		   <li> <a href="?q=archive" title="Lire le contenu plus ancien dans notre archive.">archives</a> </li>
		   <li> <a href="?q=blog" title="Lire les blogues les plus r√©cents.">blogues</a> </li>
		   <li> <a href="?q=book" title="Lire et contribuer aux livres collaboratifs.">livres</a> </li>
		   <li> <a href="?q=forum">forums</a> </li>
		   <li> <a href="?q=poll" title="Voir la liste des sondages de ce site.">sondages</a> </li>
		   <li> <a href="?q=search" title="Chercher pour du contenu plus vieux.">recherche</a></li><li><a href="http://docs.postgresqlfr.org/" target="_blank">documentation </a></li>
-->
		  </ul>
	        </div>
		</td>
		</tr>
		</table>
      </td>
     </tr>
     <tr>
    <td style="vertical-align: top; width: 20%;">
<div class="block block-user" id="block-user-0">
<div class="pgSideNav">    <h2>Ouverture de session</h2>    
		    <div>
			<form action="http://drupal.postgresql.fr/?q=user/login" method="post">
<div class="user-login-block">
<input type="hidden" name="edit[destination]" value="node/1463" />
<div class="form-item">
 <label for="edit-name">Nom d'utilisateur:</label><br />
 <input type="text" maxlength="64" class="form-text" name="edit[name]" id="edit-name" size="15" value="" />
</div>
<div class="form-item">
 <label for="edit-pass">Mot de passe:</label><br />
 <input type="password" class="form-password" maxlength="64" name="edit[pass]" id="edit-pass" size="15" value="" />
</div>
<input type="submit" class="form-submit" name="op" value="Identification"  />
</div>

</form>
<div class="item-list"><ul><li><a href="indexc12c.html?q=user/password" title="Demander un nouveau mot de passe par e-mail.">Demander un nouveau mot de passe</a></li></ul></div>
		    </div></div></div>
<div class="block block-user" id="block-user-1">
<div class="pgSideNav">    <h2>Navigation</h2>    
		    <div>
			<div class="menu">
<ul>
<li class="leaf"><a href="indexa499.html?q=tracker">messages r√©cents</a></li>

</ul>
</div>
		    </div></div></div>
<div class="block block-block" id="block-block-4">
<div class="pgSideNav">    <h2>Contactez-nous</h2>    
		    <div>
			<p><strong>Administration du site&nbsp;:</strong><br />
"equipe chez postgresqlfr point org"<br><br />
<strong>Contact presse&nbsp;:</strong><br />
"fr chez postgresql point org"<br><br />
<strong>Contact association&nbsp;:</strong><br />
"bureau chez postgresqlfr point org"<br><br />
<strong>Questions PostgreSQL&nbsp;:</strong><br />
&nbsp;IRC&nbsp;:<br />
&nbsp;&nbsp;serveur <strong>irc.freenode.net</strong><br />
&nbsp;&nbsp;canal <strong>#postgresqlfr</strong></p>

		    </div></div></div>
<div class="block block-block" id="block-block-1">
<div class="pgSideNav">    <h2>Liens</h2>    
		    <div>
			<p><small></p>
<ul>
<li>
<a href="http://www.postgresqlfr.org/?q=node/view/162">Adh√©rer</a>
</li>
<li>
<a href="http://www.postgresqlfr.org/?q=node/473">Faire un don</a>
</li>
<li>
<a href="http://www.postgresqlfr.org/?q=node/163">Consulter les statuts</a>
</li>
</ul>
<ul>
<li>
<a href="http://www.postgresql.org/" class="active">Site original<br />
</a>
</li>
<li>
<a href="http://docs.postgresqlfr.org/" class="active">Site de traduction</a>
</li>
<li>
<a href="http://docs.postgresqlfr.org/8.3/">Doc v.8.3.x fr</a>
</li>
<li>
<a href="http://docs.postgresqlfr.org/8.2/">Doc v.8.2.x fr</a>
</li>
<li>
<a href="http://docs.postgresqlfr.org/8.1/">Doc v.8.1.x fr</a>
</li>
<li>
<a href="http://docs.postgresqlfr.org/8.0/">Doc v.8.0.x fr</a>
</li>
<li>
<a href="http://docs.postgresqlfr.org/7.4/">Doc v.7.4.x fr</a>
</li>
<li>
<a href="http://www.postgis.fr/">PostGIS</a>
</li>
<li>
<a href="http://www.postgresql.org/docs/techdocs">Techdocs</a>
</li>
<li>
<a href="http://www.varlena.com/varlena/GeneralBits/Tidbits/">General TidBits</a>
</li>
<p><!--</p>
<li>
<a href="http://www.postgresqlfr.org/?q=node/view/58">Version Windows</a>
</li>
<p>--></p>
<li>
<a href="http://www.postgresqlfr.org/drupal/?q=node/view/63">T√©moignages de pros</a>
</li>
<li>
<a href="http://archives.postgresql.org/pgsql-fr-generale/">Liste de diffusion</a>
</li>
<li>
<a href="http://wwwmaster.postgresql.org/download/mirrors-ftp">T√©l√©charger</a>
</li>
</ul>
<p></small></p>

		    </div></div></div>
<div class="block block-block" id="block-block-2">
<div class="pgSideNav">    <h2>Recherche</h2>    
		    <div>
			<form action="http://drupal.postgresql.fr/?q=search" method="post">
<div id="search">
<input class="form-text" type="text" size="15" value="" name="keys" alt="Enter the terms you wish to search for." /><br />
<input class="form-submit" type="submit" value="Recherche" />
</div>
</form>

		    </div></div></div>
<div class="block block-forum" id="block-forum-0">
<div class="pgSideNav">    <h2>Sujets du forum</h2>    
		    <div>
			<div class="item-list"><h3>Sujets actifs</h3><ul><li><a href="index253f.html?q=node/1742">A LIRE : FERMETURE DES FORUMS DRUPAL</a></li><li><a href="indexfc2e.html?q=node/1739" title="2 commentaires">Probl√®me  avec pg_dump</a></li><li><a href="index97c1.html?q=node/1731" title="5 commentaires">Connexions simultann√©es</a></li><li><a href="index32d3.html?q=node/1737" title="1 commentaire">Optimisation de la m√©moire sous PostgreSQL</a></li><li><a href="index2483.html?q=node/1736" title="3 commentaires">[R√©solu] Upgrade Postgre -> types et op√©rateurs</a></li></ul></div><div class="item-list"><h3>Nouveaux sujets:</h3><ul><li><a href="index253f.html?q=node/1742">A LIRE : FERMETURE DES FORUMS DRUPAL</a></li><li><a href="indexfc2e.html?q=node/1739" title="2 commentaires">Probl√®me  avec pg_dump</a></li><li><a href="index32d3.html?q=node/1737" title="1 commentaire">Optimisation de la m√©moire sous PostgreSQL</a></li><li><a href="index2483.html?q=node/1736" title="3 commentaires">[R√©solu] Upgrade Postgre -> types et op√©rateurs</a></li><li><a href="index82c4.html?q=node/1734" title="2 commentaires">[RESOLU] Probleme de connection en odbc</a></li></ul></div><div class="more-link"><a href="index79b7.html?q=forum" title="Lire les derniers sujets.">en lire plus</a></div>
		    </div></div></div>
<div class="block block-archive" id="block-archive-0">
<div class="pgSideNav">    <h2>Acc√©der aux archives</h2>    
		    <div>
			
<!-- calendar -->
<div class="calendar"><table summary="Un calendrier pour acc√©der aux archives.">
 <caption><a href="index9dfb.html?q=archive/2008/09/12" title="Mois pr√©c√©dent">&laquo;</a> Octobre 2008 &nbsp;</caption>
 <tr class="header-week">
 <th abbr="Lundi">Lun</th>
 <th abbr="Mardi">Mar</th>
 <th abbr="Mercredi">Mer</th>
 <th abbr="Jeudi">Jeu</th>
 <th abbr="Vendredi">Ven</th>
 <th abbr="Samedi">Sam</th>
 <th abbr="Dimanche">Dim</th>
</tr>
 <tr class="row-week"><td class="day-blank" colspan="2">&nbsp;</td>
  <td class="day-link"><a href="indexd3e2.html?q=archive/2008/10/1">1</a></td>
  <td class="day-normal">2</td>
  <td class="day-normal">3</td>
  <td class="day-normal">4</td>
  <td class="day-normal">5</td>
 </tr>
 <tr class="row-week">
  <td class="day-normal">6</td>
  <td class="day-normal">7</td>
  <td class="day-normal">8</td>
  <td class="day-normal">9</td>
  <td class="day-normal">10</td>
  <td class="day-normal">11</td>
  <td class="day-today">12</td>
 </tr>
 <tr class="row-week">
  <td class="day-future">13</td>
  <td class="day-future">14</td>
  <td class="day-future">15</td>
  <td class="day-future">16</td>
  <td class="day-future">17</td>
  <td class="day-future">18</td>
  <td class="day-future">19</td>
 </tr>
 <tr class="row-week">
  <td class="day-future">20</td>
  <td class="day-future">21</td>
  <td class="day-future">22</td>
  <td class="day-future">23</td>
  <td class="day-future">24</td>
  <td class="day-future">25</td>
  <td class="day-future">26</td>
 </tr>
 <tr class="row-week">
  <td class="day-future">27</td>
  <td class="day-future">28</td>
  <td class="day-future">29</td>
  <td class="day-future">30</td>
  <td class="day-future">31</td>
  <td class="day-blank" colspan="2">&nbsp;</td>
 </tr>
</table></div>


		    </div></div></div>
<div class="block block-node" id="block-node-0">
<div class="pgSideNav">    <h2>Syndication</h2>    
		    <div>
			<div class="xml-icon"><a href="index9637.html?q=rss.xml"><img src="misc/xml.png" width="36" height="14" alt="Flux XML" title="Flux XML" /></a></div>
		    </div></div></div>
<div class="block block-poll" id="block-poll-0">
<div class="pgSideNav">    <h2>Sondage</h2>    
		    <div>
			<div class="poll"><div class="title">Quelle est la version de PostgreSQL la plus r√©pandue sur vos serveurs ?</div><div class="text">8.3</div><div class="bar"><div style="width: 10%;" class="foreground"></div></div><div class="percent">10%</div><div class="text">8.2</div><div class="bar"><div style="width: 42%;" class="foreground"></div></div><div class="percent">42%</div><div class="text">8.1</div><div class="bar"><div style="width: 40%;" class="foreground"></div></div><div class="percent">40%</div><div class="text">8.0</div><div class="bar"><div style="width: 2%;" class="foreground"></div></div><div class="percent">2%</div><div class="text">7.4</div><div class="bar"><div style="width: 6%;" class="foreground"></div></div><div class="percent">6%</div><div class="text">7.3 ou ant√©rieure</div><div class="bar"><div style="width: 0%;" class="foreground"></div></div><div class="percent">0%</div><div class="total">Nombre de votes: 48</div></div><div class="links"><a href="index8c57.html?q=node/1426#comment" title="Sauter au premier commentaire de ce message.">3 commentaires</a> | <a href="index729f.html?q=poll" title="Voir la liste des sondages de ce site.">anciens sondages</a></div>
		    </div></div></div>
    </td>

      <td style="vertical-align: top; width: 80%"><div class="breadcrumb"><a href="index03d2.html?q=">Accueil</a> &raquo; <a href="index79b7.html?q=forum">forums</a></div><h2 class="title">fonction postgresql</h2>
<!-- begin content -->

<!-- node: "fonction postgresql" -->
<!--<div class="pgFrontCenterUser">
<div class="pgFrontUser">
<div class="pgFrontUserInner">
--><div class="pgFrontUserWrap">
 <div class="pgFrontUserContent">	<h1 class="plop"> | <a href="index7297.html?q=node/1463" class="active">fonction postgresql</a></h1>
		    <p>
			    Par <a href="index5c49.html?q=user/2999" title="Voir le profil utilisateur.">alterego</a> le 16/11/2007 - 15:39
		    </p>	
			    <p>Dans 1 table -><br />
<p class="code">
create table jo_essai_systeme (<br />
&nbsp;&nbsp;nom_champ varchar(50),<br />
&nbsp;&nbsp;nb_enr numeric(6)<br />
);
</p>
"nom_champ" contient en fait les noms des colonnes d'1 autre table.<br />
<p class="code">
CREATE FUNCTION jo_function_temp() RETURNS integer AS '<br />
DECLARE<br />
&nbsp;&nbsp;c_nom cursor for select nom_champ from jo_essai_systeme ;<br />
&nbsp;&nbsp;s_nom jo_essai_systeme.nom_champ%TYPE;<br />
&nbsp;&nbsp;vnb numeric ;<br />
BEGIN<br />
&nbsp;&nbsp;OPEN c_nom;<br />
&nbsp;&nbsp;LOOP<br />
&nbsp;&nbsp;FETCH c_nom into s_nom;<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF NOT FOUND THEN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT;<br />
&nbsp;&nbsp;&nbsp;&nbsp;END IF;<br />
&nbsp;&nbsp;&nbsp;&nbsp;select count(s_nom) into nb from analyses where s_nom is not null  ;<br />
&nbsp;&nbsp;&nbsp;&nbsp;update jo_essai_systeme<br />
&nbsp;&nbsp;&nbsp;&nbsp;set nb_enr = nb where nom_champ = s_nom ;<br />
&nbsp;&nbsp;END LOOP ;<br />
&nbsp;<br />
&nbsp;&nbsp;CLOSE c_nom ;<br />
&nbsp;&nbsp;RETURN 1 ;<br />
END ;<br />
' LANGUAGE plpgsql;
</p>
Je veux simplement compter dans nb_enr de jo_essai_systeme, pour chacun des champs de cette table, les champs de la table analyses qui sont renseign√©s. Est-ce que je suis clair?<br />
ex : dans jo_essai_systeme j'ai 1 CHAMP intitul√© "pretrait" et dans analyses j'ai 1 COLONNE "pretrait".<br />
Tel que j'ai √©crit la fonction, je ram√®ne systematiquement lnb total d'enregistrements de analyses.<br />
J'ai 1 pb de CONTENU et CONTENANT!!<br />
merci par avance.</p>

		     </div></div>
<!--</div>
</div>
</div>
</div> -->
<a id="comment"></a>
<form method="post" action="http://drupal.postgresql.fr/?q=comment"><div>
<div class="pgSideNav">    <h2>Options d'affichage des commentaires</h2>    
		    <div>
			<div class="form-item">
 <select name="mode"> <option value="1">A plat - repli√©</option>
 <option value="2">A plat - d√©pli√©</option>
 <option value="3">Par discussions - repli√©</option>
 <option value="4" selected="selected">Par discussions - d√©pli√©</option>
</select>
<select name="order"> <option value="1">Date - r√©cents en premier</option>
 <option value="2" selected="selected">Date - anciens en premier</option>
</select>
<select name="comments_per_page"> <option value="10">10 commentaires par page</option> <option value="30">30 commentaires par page</option> <option value="50" selected="selected">50 commentaires par page</option> <option value="70">70 commentaires par page</option> <option value="90">90 commentaires par page</option></select>
<input type="hidden" name="threshold" value="0" />
 <input type="submit" class="form-submit" name="op" value="Sauvegarder les param√®tres"  />

 <div class="description">S√©lectionnez la m√©thode d'affichage des commentaires que vous pr√©f√©rez, puis cliquez sur "Sauvegarder les param√®tres" pour activer vos changements.</div>
</div>

		    </div></div><input type="hidden" name="edit[nid]" value="1463" />
</div></form><form method="post" action="http://drupal.postgresql.fr/?q=comment"><div>
<input type="hidden" name="edit[nid]" value="1463" />
<a id="comment-4661"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">HELP, je suis vraiment conc√©!!</h1>
		<p>
		    <b><a href="index5c49.html?q=user/2999" title="Voir le profil utilisateur.">alterego</a></b>/ = 20 Novembre, 2007 - 14:42
		</p>
		<p>
		    <p>svp r√©pondre, m√™me s'il n'y a pas de solution</p>
<p><b>Message du mod√©rateur: merci de ne pas poster de message en double, de plus avec un sujet n'indiquant pas dans quelle cat√©gorie rentre le probl√®me.</b></p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div><a id="comment-4667"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">Erreur</h1>
		<p>
		    <b><a href="index6e6b.html?q=user/65" title="Voir le profil utilisateur.">SAS</a></b>/ = 20 Novembre, 2007 - 23:43
		</p>
		<p>
		    <p>La requ√™te </p>
<p>update jo_essai_systeme<br />
    set nb_enr = nb where nom_champ = s_nom ;</p>
<p>me semble fausse. s_nom est une cha√Æne de caract√®re et non une colonne.</p>
<p>Librement,<br />
St√©phane Schildknecht<br />
<a href="http://www.dalibo.com/">dalibo</a><br />
<a href="http://www.postgresqlfr.org/">PostgreSQLFr</a></p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div><a id="comment-4674"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">fonction postgresql</h1>
		<p>
		    <b><a href="index5c49.html?q=user/2999" title="Voir le profil utilisateur.">alterego</a></b>/ = 21 Novembre, 2007 - 12:41
		</p>
		<p>
		    <p>c'est bien l√† mon probl√®me. Cette chaine de caract√®re contient le nom d'1 colonne.<br />
Cette fonction est sens√©e tourner m√™me si on ajoute 1 champ √† la table analyses. Pour comprendre je compl√®te avec le d√©but de la fonction.</p>
<p>create table jo_essai_systeme(nom_champ varchar(50),<br />
                              nb_enr numeric(6));<br />
insert into jo_essai_systeme(nom_champ)<br />
select attname from pg_attribute where attrelid =<br />
                                        (select oid from pg_class where relname ilike 'analyses')<br />
                                 and attname not like 'met%';</p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div><a id="comment-4675"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">Ma solution</h1>
		<p>
		    <b><a href="indexb3f1.html?q=user/1013" title="Voir le profil utilisateur.">sparky</a></b>/ = 21 Novembre, 2007 - 13:00
		</p>
		<p>
		    <p>Qq erreurs<br />
1. Changer vnb par nb<br />
2. Tu dois utiliser du sql dynamique : http://docs.postgresqlfr.org/8.1/plpgsql-statements.html<br />
3. si s_nom est un nom de colonne,alors ton select ne fonctionnera pas, car le select into ne peut √™tre en dynamique (pour le moment)<br />
Donc tout code devrait √™tre<br />
<p class="code">
 CREATE or replace FUNCTION jo_function_temp() RETURNS integer AS<br />
 $$<br />
 DECLARE<br />
  c_nom cursor for select nom_champ from jo_essai_systeme ;<br />
  s_nom jo_essai_systeme.nom_champ%TYPE;<br />
  nb numeric ;<br />
BEGIN<br />
  OPEN c_nom;<br />
  LOOP<br />
  FETCH c_nom into s_nom;<br />
        raise notice 'Colonne is %',s_nom;<br />
    IF NOT FOUND THEN<br />
        raise notice 'NOT FOUND';<br />
      EXIT;<br />
    END IF;<br />
    execute 'select count(*) from analyses where '||s_nom||' is not null ' into nb;<br />
        raise notice 'Nb record = %',nb;<br />
    update jo_essai_systeme set nb_enr = nb where nom_champ = s_nom ;<br />
  END LOOP ;<br />
  CLOSE c_nom ;<br />
  RETURN 1 ;<br />
END ; $$ LANGUAGE plpgsql;
</p>
<p>Cela fonctionne sur une 8.2</p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div><a id="comment-4679"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">fonction postgresql</h1>
		<p>
		    <b><a href="index5c49.html?q=user/2999" title="Voir le profil utilisateur.">alterego</a></b>/ = 21 Novembre, 2007 - 16:27
		</p>
		<p>
		    <p>Merci pour ta r√©ponse.<br />
le vnb √† remplacer par nb √©tait en fait 1 erreur de recopie √©cran.</p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div><a id="comment-4683"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">Et ?</h1>
		<p>
		    <b><a href="index6e6b.html?q=user/65" title="Voir le profil utilisateur.">SAS</a></b>/ = 22 Novembre, 2007 - 10:51
		</p>
		<p>
		    <p>Quid du reste des propositions de sparky ?</p>
<p>Librement,<br />
St√©phane Schildknecht<br />
<a href="http://www.dalibo.com/">dalibo</a><br />
<a href="http://www.postgresqlfr.org/">PostgreSQLFr</a></p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div><div style="margin-left:25px;">
<a id="comment-4686"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">fonction postgresql</h1>
		<p>
		    <b><a href="index5c49.html?q=user/2999" title="Voir le profil utilisateur.">alterego</a></b>/ = 23 Novembre, 2007 - 10:37
		</p>
		<p>
		    <p>Waloo!<br />
<p class="code">
psql:essai_systeme.sql:10: ERROR:  function jo_function_temp() does not exist<br />
psql:essai_systeme.sql:30: ERROR:  syntax error at or near "select" at character 333<br />
psql:essai_systeme.sql:32: ERROR:  function jo_function_temp() does not exist<br />
HINT:  No function matches the given name and argument types. You may need to add explicit type casts.<br />
psql:essai_systeme.sql:34: ERROR:  function jo_function_temp() does not exist<br />
mesage d'erreur??<br />
CREATE FUNCTION jo_function_temp() RETURNS integer AS '<br />
DECLARE<br />
c_nom cursor for select nom_champ from jo_essai_systeme ;<br />
s_nom jo_essai_systeme.nom_champ%TYPE;<br />
nb numeric ;<br />
BEGIN<br />
OPEN c_nom;<br />
LOOP<br />
FETCH c_nom into s_nom;<br />
raise notice \'Colone is %\',s_nom;<br />
IF NOT FOUND THEN raise notice \'NOT FOUND\'; EXIT ; END IF;<br />
    execute 'select count(*) from analyses where '||s_nom||'is not null' into nb;<br />
raise notice \'nb record = %\',nb ;<br />
    update jo_essai_systeme<br />
    set nb_enr = nb where nom_champ = s_nom ;<br />
END LOOP ;<br />
CLOSE c_nom ;<br />
RETURN 1 ;<br />
END ;<br />
' LANGUAGE plpgsql;
</p>
Est-ce ma version 7<br />
qui met la pagaille?<br />
J'en ai 1 peu ras le bol. J'ai essay√© dans tous les sens!! Merci √† vous</p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div></div>
<a id="comment-4687"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">Oui j'ai bien dit = "sur ma v</h1>
		<p>
		    <b><a href="indexb3f1.html?q=user/1013" title="Voir le profil utilisateur.">sparky</a></b>/ = 23 Novembre, 2007 - 11:03
		</p>
		<p>
		    <p>Oui j'ai bien dit = "sur ma version 8.2" donc le probl√®me maintenant c'est que tu dois adapter pour avoir qq chose qui tourne sur une 7</p>
<p>Cela fait longtemps que je n'ai plus utilis√© une 7 mais je crois que le probl√®me vient des guillements utiliser apr√®s as et dans la fonction dynamique voir ici<br />
http://docs.postgresqlfr.org/7.4/plpgsql-development-tips.html</p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div><a id="comment-4688"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">fonction postgresql</h1>
		<p>
		    <b><a href="index5c49.html?q=user/2999" title="Voir le profil utilisateur.">alterego</a></b>/ = 23 Novembre, 2007 - 14:24
		</p>
		<p>
		    <p>o√π cha√Æne-commande est une expression manipulant une cha√Æne (de type text) contenant la commande √† √™tre ex√©cut√©e. Cette cha√Æne est litt√©ralement donn√©e √† manger au moteur SQL.<br />
Notez en particulier qu'aucune substitution de variable PL/pgSQL n'est faite sur la cha√Æne-commande. Les valeurs des variables doivent √™tre ins√©r√©es dans la cha√Æne de commande lors de sa construction.<br />
Voil√† ce que j'ai trouv√© dans la doc, qui laisserai supposer qu'il faut √† chaque fois donner la valeur de la variable. J'ai essay√© les simples ou double '', √©galement le caract√©re d'√©chappeent. Je suis oblig√© de passer maintenant le bb au coll√®gue en esp√©rant qu'il aura + de r√©ussite que moi. C'est pas bon pour ma promo!!<br />
Merci √† tous. Bien qu n'ayant pas eu de succ√©s, c'est 1 forum qui a le m√©rite d'exister.</p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div><a id="comment-4690"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">la soluce</h1>
		<p>
		    <b><a href="indexb3f1.html?q=user/1013" title="Voir le profil utilisateur.">sparky</a></b>/ = 23 Novembre, 2007 - 18:44
		</p>
		<p>
		    <p class="code">execute ''select count(*) from analyses where ''||s_nom||''is not null'' into nb;
</p>
Il fallait doubler les quotes :-)</p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div><div style="margin-left:25px;">
<a id="comment-4695"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">fonction postgresql</h1>
		<p>
		    <b><a href="index5c49.html?q=user/2999" title="Voir le profil utilisateur.">alterego</a></b>/ = 26 Novembre, 2007 - 10:25
		</p>
		<p>
		    <p>j'ai d√©j√† essay√© de doubler les quotes. Je vais encore v√©rifier, peut-√™tre que j'ai<br />
les id√©es + claires le matin!!</p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div></div>
<div style="margin-left:25px;">
<a id="comment-4696"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">fonction postgresql</h1>
		<p>
		    <b><a href="index5c49.html?q=user/2999" title="Voir le profil utilisateur.">alterego</a></b>/ = 26 Novembre, 2007 - 10:31
		</p>
		<p>
		    <p>C'est fait. Voici le message d'erreur<br />
psql:essai_systeme.sql:31: NOTICE:  Colone is no_prof_base<br />
psql:essai_systeme.sql:31: ERROR:  syntax error at or near "$2" at character 76<br />
CONTEXT:  PL/pgSQL function "jo_function_temp" line 11 at execute statement</p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div></div>
<a id="comment-4697"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">Pourquoi ne pas upgrader √† l</h1>
		<p>
		    <b><a href="indexb3f1.html?q=user/1013" title="Voir le profil utilisateur.">sparky</a></b>/ = 26 Novembre, 2007 - 16:12
		</p>
		<p>
		    <p>Pourquoi ne pas upgrader √† la 8 ? La 7 c'est vraiment vieux. Tu peux aussi regarder dans les logs de postgresql pour voir quelle est la requete sql re√ßue ...</p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div><div style="margin-left:25px;">
<a id="comment-4698"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">fonction postgresql</h1>
		<p>
		    <b><a href="index5c49.html?q=user/2999" title="Voir le profil utilisateur.">alterego</a></b>/ = 26 Novembre, 2007 - 17:22
		</p>
		<p>
		    <p>C'est pas moi qui d√©cide. Je ne suis que le grouillau(?) de service et je n'ai pas forc√©ment tous les pouvoirs</p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div></div>
<a id="comment-4699"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">R√©capitulons</h1>
		<p>
		    <b><a href="index6e6b.html?q=user/65" title="Voir le profil utilisateur.">SAS</a></b>/ = 27 Novembre, 2007 - 13:18
		</p>
		<p>
		    <p>Pouvez-vous nous donner la derni√®re version de la fonction et les derniers messages d'erreur ?</p>
<p>Librement,<br />
St√©phane Schildknecht<br />
<a href="http://www.dalibo.com/">dalibo</a><br />
<a href="http://www.postgresqlfr.org/">PostgreSQLFr</a></p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div><div style="margin-left:25px;">
<a id="comment-4708"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">fonction postgresql</h1>
		<p>
		    <b><a href="index5c49.html?q=user/2999" title="Voir le profil utilisateur.">alterego</a></b>/ = 3 D√©cembre, 2007 - 11:25
		</p>
		<p>
		    <p>DROP TABLE<br />
CREATE TABLE<br />
INSERT 0 152<br />
DELETE 7<br />
psql:essai_systeme.sql:10: ERROR:  function jo_function_temp() does not exist<br />
CREATE FUNCTION<br />
psql:essai_systeme.sql:31: NOTICE:  Colone is no_prof_base<br />
psql:essai_systeme.sql:31: ERROR:  syntax error at or near "$2" at character 76<br />
CONTEXT:  PL/pgSQL function "jo_function_temp" line 11 at execute statement<br />
Voici l'erreur</p>
<p>voici la derni√®re version<br />
drop table jo_essai_systeme ;<br />
create table jo_essai_systeme(nom_champ varchar(50),<br />
                              nb_enr numeric(6));<br />
insert into jo_essai_systeme(nom_champ)<br />
select attname from pg_attribute where attrelid =<br />
                                        (select oid from pg_class where relname ilike 'analyses')<br />
                                 and attname not like 'met%';<br />
delete from jo_essai_systeme where nom_champ in('tableoid','cmax','cmin','xmax','xmin','oid','ctid');<br />
DROP function jo_function_temp();<br />
CREATE FUNCTION jo_function_temp() RETURNS integer AS '<br />
DECLARE<br />
c_nom cursor for select nom_champ from jo_essai_systeme ;<br />
s_nom jo_essai_systeme.nom_champ%TYPE;<br />
nb numeric ;<br />
BEGIN<br />
OPEN c_nom;<br />
LOOP<br />
FETCH c_nom into s_nom;<br />
raise notice \'Colone is %\',s_nom;<br />
IF NOT FOUND THEN raise notice \'NOT FOUND\'; EXIT ; END IF;</p>
<p>execute ''select count(*) from analyses where ''||s_nom||'' is not null'' into nb;<br />
    update jo_essai_systeme<br />
    set nb_enr = nb where nom_champ = s_nom ;<br />
END LOOP ;<br />
CLOSE c_nom ;<br />
RETURN 1 ;<br />
END ;<br />
' LANGUAGE plpgsql;<br />
-- Execution<br />
select jo_function_temp();</p>
<p>Excuses, j'√©tais pass√© √† autre chose ce qui fait que je n'avais pas consult√© ma messagerie.<br />
je suis en d√©placement toute cette fin de semaine.</p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div></div>
<a id="comment-4709"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">Et si on essayait  ?

execu</h1>
		<p>
		    <b><a href="indexb3f1.html?q=user/1013" title="Voir le profil utilisateur.">sparky</a></b>/ = 3 D√©cembre, 2007 - 14:41
		</p>
		<p>
		    <p>Et si on essayait  ?<br />
<p class="code">
execute \'select count(*) from analyses where \'||s_nom||\' is not null\' into nb;
</p>
<p>Normalement dans les log de postgresql tu peux voir quelle requ√™te a √©t√© lanc√©e et donc la corriger</p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div></div></form>
<!-- end content -->
              </td>

    </tr>
    <tr><td colspan="2">

		<div class="pgTopNav">
		   <div class="pgTopNavLeft"> 
		     <img src="layout/images/nav_lft.png" width="7" height="23" alt="" />
		   </div>
		   <div class="pgTopNavRight">
		    <img src="layout/images/nav_rgt.png" width="7" height="23" alt="" />
		  </div>
		  <!--<ul class="pgTopNavList">-->
		  <ul class="pgTopNavList">
		   <li><a href="index03d2.html?q=" title="Retourner √† la page principale.">accueil</a> </li>
		   <li> <a href="indexf6e5.html?q=archive" title="Lire le contenu plus ancien dans notre archive.">archives</a> </li>
		   <li> <a href="index71c4.html?q=blog" title="Lire les blogues les plus r√©cents.">blogues</a> </li>

		   <li> <a href="indexf6fe.html?q=book" title="Lire et contribuer aux livres collaboratifs.">livres</a> </li>
		   <li> <a href="index79b7.html?q=forum">forums</a> </li>
		   <li> <a href="index729f.html?q=poll" title="Voir la liste des sondages de ce site.">sondages</a> </li>
		   <li> <a href="index4404.html?q=search" title="Chercher pour du contenu plus vieux.">recherche</a></li><li><a href="http://docs.postgresqlfr.org/" target="_blank">documentation </a></li>

		  </ul>

<!--
		   <li><a href="?q=" title="Retourner √† la page principale.">accueil</a> </li>
		   <li> <a href="?q=archive" title="Lire le contenu plus ancien dans notre archive.">archives</a> </li>
		   <li> <a href="?q=blog" title="Lire les blogues les plus r√©cents.">blogues</a> </li>
		   <li> <a href="?q=book" title="Lire et contribuer aux livres collaboratifs.">livres</a> </li>
		   <li> <a href="?q=forum">forums</a> </li>
		   <li> <a href="?q=poll" title="Voir la liste des sondages de ce site.">sondages</a> </li>
		   <li> <a href="?q=search" title="Chercher pour du contenu plus vieux.">recherche</a></li><li><a href="http://docs.postgresqlfr.org/" target="_blank">documentation </a></li>
-->
		  </ul>
	        </div>
    </td></tr>
   </table>
   <p style="text-align: center;">&copy;&nbsp;PostgreSQLFr, tous droits r√©serv√©s.<br>
Site d√©clar√© √† la CNIL sous le num√©ro 1074678, conform√©ment √† la Loi en vigueur.
</p>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-3921927-1");
pageTracker._initData();
pageTracker._trackPageview();
</script>
<p></p>
   
</body>

<!-- Mirrored from drupal.postgresql.fr/?q=node/1463 by HTTrack Website Copier/3.x [XR&CO'2006], Sun, 12 Oct 2008 16:59:45 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>