
<!DOCTYPE
 html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
 <html>
 <!-- $Date: 2005/08/30 07:54:43 $ / $Revision: 1.29 $ / Last Theme Editor :$Author: jx $-->
  
<!-- Mirrored from drupal.postgresql.fr/?q=node/1445 by HTTrack Website Copier/3.x [XR&CO'2006], Sun, 12 Oct 2008 16:41:52 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<base  />
<style type="text/css" media="all">@import "misc/drupal.css";</style>
   <title>Probl√®me de partitionnement - PostgreSQLFr</title>
 <style type="text/css" media="screen" title="Normal Text">
    @import url("layout/css/blue/fixed.css");
    @import url(_guillaume/dotclear/themes/postgresql/style.html);
 </style>
 <style type="text/css" media="screen" title="Normal Text2">
    @import url("layout/css/blue/pgfr.css");
    @import url(_guillaume/dotclear/themes/postgresql/style.html);
 </style>
   </head>
   <body>
    <table border="0" cellspacing="5" cellpadding="0" width="100%">
     <tr>
      <!--td colspan="2" width="100%"-->
      <td colspan="2">
      <!-- Head -->
       <table border="0" cellspacing="0" cellpadding="0" width="100%">
        <tr>
	 <td align="left">
           <div id="pgHeader">
	    <div id="pgHeaderLogoLeft">
	     <a href="index.html" title="PostgreSQL"><img src="layout/images/hdr_left.png" width="230" height="80" alt="PostgreSQL" /></a>
	    </div>
	    <div id="pgHeaderLogoRight">
	     <a href="index.html" title="La base de donnÈes la plus sophistiquÈe au monde."><img src="layout/images/hdr_right.png" width="210" height="80" alt="La base de donnÈes la plus sophistiquÈe au monde." /></a>
	    </div>
	   </div>
         </td>
	 <td align="right">
         </td>
	</tr>
      </table> <!-- Head -->
      <br />
      <table border="0" cellspacing="0" cellpadding="0" width="100%">
              <tr>
	      	 <td align="left">

		<div class="pgTopNav">
		   <div class="pgTopNavLeft"> 
		     <img src="layout/images/nav_lft.png" width="7" height="23" alt="" />
		   </div>
		   <div class="pgTopNavRight">
		    <img src="layout/images/nav_rgt.png" width="7" height="23" alt="" />
		  </div>
		  <!--<ul class="pgTopNavList">-->
		  <ul class="pgTopNavList">
		   <li><a href="index03d2.html?q=" title="Retourner √† la page principale.">accueil</a> </li>
		   <li> <a href="indexf6e5.html?q=archive" title="Lire le contenu plus ancien dans notre archive.">archives</a> </li>
		   <li> <a href="index71c4.html?q=blog" title="Lire les blogues les plus r√©cents.">blogues</a> </li>

		   <li> <a href="indexf6fe.html?q=book" title="Lire et contribuer aux livres collaboratifs.">livres</a> </li>
		   <li> <a href="index79b7.html?q=forum">forums</a> </li>
		   <li> <a href="index729f.html?q=poll" title="Voir la liste des sondages de ce site.">sondages</a> </li>
		   <li> <a href="index4404.html?q=search" title="Chercher pour du contenu plus vieux.">recherche</a></li><li><a href="http://docs.postgresqlfr.org/" target="_blank">documentation </a></li>

		  </ul>

<!--
		   <li><a href="?q=" title="Retourner √† la page principale.">accueil</a> </li>
		   <li> <a href="?q=archive" title="Lire le contenu plus ancien dans notre archive.">archives</a> </li>
		   <li> <a href="?q=blog" title="Lire les blogues les plus r√©cents.">blogues</a> </li>
		   <li> <a href="?q=book" title="Lire et contribuer aux livres collaboratifs.">livres</a> </li>
		   <li> <a href="?q=forum">forums</a> </li>
		   <li> <a href="?q=poll" title="Voir la liste des sondages de ce site.">sondages</a> </li>
		   <li> <a href="?q=search" title="Chercher pour du contenu plus vieux.">recherche</a></li><li><a href="http://docs.postgresqlfr.org/" target="_blank">documentation </a></li>
-->
		  </ul>
	        </div>
		</td>
		</tr>
		</table>
      </td>
     </tr>
     <tr>
    <td style="vertical-align: top; width: 20%;">
<div class="block block-user" id="block-user-0">
<div class="pgSideNav">    <h2>Ouverture de session</h2>    
		    <div>
			<form action="http://drupal.postgresql.fr/?q=user/login" method="post">
<div class="user-login-block">
<input type="hidden" name="edit[destination]" value="node/1445" />
<div class="form-item">
 <label for="edit-name">Nom d'utilisateur:</label><br />
 <input type="text" maxlength="64" class="form-text" name="edit[name]" id="edit-name" size="15" value="" />
</div>
<div class="form-item">
 <label for="edit-pass">Mot de passe:</label><br />
 <input type="password" class="form-password" maxlength="64" name="edit[pass]" id="edit-pass" size="15" value="" />
</div>
<input type="submit" class="form-submit" name="op" value="Identification"  />
</div>

</form>
<div class="item-list"><ul><li><a href="indexc12c.html?q=user/password" title="Demander un nouveau mot de passe par e-mail.">Demander un nouveau mot de passe</a></li></ul></div>
		    </div></div></div>
<div class="block block-user" id="block-user-1">
<div class="pgSideNav">    <h2>Navigation</h2>    
		    <div>
			<div class="menu">
<ul>
<li class="leaf"><a href="indexa499.html?q=tracker">messages r√©cents</a></li>

</ul>
</div>
		    </div></div></div>
<div class="block block-block" id="block-block-4">
<div class="pgSideNav">    <h2>Contactez-nous</h2>    
		    <div>
			<p><strong>Administration du site&nbsp;:</strong><br />
"equipe chez postgresqlfr point org"<br><br />
<strong>Contact presse&nbsp;:</strong><br />
"fr chez postgresql point org"<br><br />
<strong>Contact association&nbsp;:</strong><br />
"bureau chez postgresqlfr point org"<br><br />
<strong>Questions PostgreSQL&nbsp;:</strong><br />
&nbsp;IRC&nbsp;:<br />
&nbsp;&nbsp;serveur <strong>irc.freenode.net</strong><br />
&nbsp;&nbsp;canal <strong>#postgresqlfr</strong></p>

		    </div></div></div>
<div class="block block-block" id="block-block-1">
<div class="pgSideNav">    <h2>Liens</h2>    
		    <div>
			<p><small></p>
<ul>
<li>
<a href="http://www.postgresqlfr.org/?q=node/view/162">Adh√©rer</a>
</li>
<li>
<a href="http://www.postgresqlfr.org/?q=node/473">Faire un don</a>
</li>
<li>
<a href="http://www.postgresqlfr.org/?q=node/163">Consulter les statuts</a>
</li>
</ul>
<ul>
<li>
<a href="http://www.postgresql.org/" class="active">Site original<br />
</a>
</li>
<li>
<a href="http://docs.postgresqlfr.org/" class="active">Site de traduction</a>
</li>
<li>
<a href="http://docs.postgresqlfr.org/8.3/">Doc v.8.3.x fr</a>
</li>
<li>
<a href="http://docs.postgresqlfr.org/8.2/">Doc v.8.2.x fr</a>
</li>
<li>
<a href="http://docs.postgresqlfr.org/8.1/">Doc v.8.1.x fr</a>
</li>
<li>
<a href="http://docs.postgresqlfr.org/8.0/">Doc v.8.0.x fr</a>
</li>
<li>
<a href="http://docs.postgresqlfr.org/7.4/">Doc v.7.4.x fr</a>
</li>
<li>
<a href="http://www.postgis.fr/">PostGIS</a>
</li>
<li>
<a href="http://www.postgresql.org/docs/techdocs">Techdocs</a>
</li>
<li>
<a href="http://www.varlena.com/varlena/GeneralBits/Tidbits/">General TidBits</a>
</li>
<p><!--</p>
<li>
<a href="http://www.postgresqlfr.org/?q=node/view/58">Version Windows</a>
</li>
<p>--></p>
<li>
<a href="http://www.postgresqlfr.org/drupal/?q=node/view/63">T√©moignages de pros</a>
</li>
<li>
<a href="http://archives.postgresql.org/pgsql-fr-generale/">Liste de diffusion</a>
</li>
<li>
<a href="http://wwwmaster.postgresql.org/download/mirrors-ftp">T√©l√©charger</a>
</li>
</ul>
<p></small></p>

		    </div></div></div>
<div class="block block-block" id="block-block-2">
<div class="pgSideNav">    <h2>Recherche</h2>    
		    <div>
			<form action="http://drupal.postgresql.fr/?q=search" method="post">
<div id="search">
<input class="form-text" type="text" size="15" value="" name="keys" alt="Enter the terms you wish to search for." /><br />
<input class="form-submit" type="submit" value="Recherche" />
</div>
</form>

		    </div></div></div>
<div class="block block-forum" id="block-forum-0">
<div class="pgSideNav">    <h2>Sujets du forum</h2>    
		    <div>
			<div class="item-list"><h3>Sujets actifs</h3><ul><li><a href="index253f.html?q=node/1742">A LIRE : FERMETURE DES FORUMS DRUPAL</a></li><li><a href="indexfc2e.html?q=node/1739" title="2 commentaires">Probl√®me  avec pg_dump</a></li><li><a href="index97c1.html?q=node/1731" title="5 commentaires">Connexions simultann√©es</a></li><li><a href="index32d3.html?q=node/1737" title="1 commentaire">Optimisation de la m√©moire sous PostgreSQL</a></li><li><a href="index2483.html?q=node/1736" title="3 commentaires">[R√©solu] Upgrade Postgre -> types et op√©rateurs</a></li></ul></div><div class="item-list"><h3>Nouveaux sujets:</h3><ul><li><a href="index253f.html?q=node/1742">A LIRE : FERMETURE DES FORUMS DRUPAL</a></li><li><a href="indexfc2e.html?q=node/1739" title="2 commentaires">Probl√®me  avec pg_dump</a></li><li><a href="index32d3.html?q=node/1737" title="1 commentaire">Optimisation de la m√©moire sous PostgreSQL</a></li><li><a href="index2483.html?q=node/1736" title="3 commentaires">[R√©solu] Upgrade Postgre -> types et op√©rateurs</a></li><li><a href="index82c4.html?q=node/1734" title="2 commentaires">[RESOLU] Probleme de connection en odbc</a></li></ul></div><div class="more-link"><a href="index79b7.html?q=forum" title="Lire les derniers sujets.">en lire plus</a></div>
		    </div></div></div>
<div class="block block-archive" id="block-archive-0">
<div class="pgSideNav">    <h2>Acc√©der aux archives</h2>    
		    <div>
			
<!-- calendar -->
<div class="calendar"><table summary="Un calendrier pour acc√©der aux archives.">
 <caption><a href="index9dfb.html?q=archive/2008/09/12" title="Mois pr√©c√©dent">&laquo;</a> Octobre 2008 &nbsp;</caption>
 <tr class="header-week">
 <th abbr="Lundi">Lun</th>
 <th abbr="Mardi">Mar</th>
 <th abbr="Mercredi">Mer</th>
 <th abbr="Jeudi">Jeu</th>
 <th abbr="Vendredi">Ven</th>
 <th abbr="Samedi">Sam</th>
 <th abbr="Dimanche">Dim</th>
</tr>
 <tr class="row-week"><td class="day-blank" colspan="2">&nbsp;</td>
  <td class="day-link"><a href="indexd3e2.html?q=archive/2008/10/1">1</a></td>
  <td class="day-normal">2</td>
  <td class="day-normal">3</td>
  <td class="day-normal">4</td>
  <td class="day-normal">5</td>
 </tr>
 <tr class="row-week">
  <td class="day-normal">6</td>
  <td class="day-normal">7</td>
  <td class="day-normal">8</td>
  <td class="day-normal">9</td>
  <td class="day-normal">10</td>
  <td class="day-normal">11</td>
  <td class="day-today">12</td>
 </tr>
 <tr class="row-week">
  <td class="day-future">13</td>
  <td class="day-future">14</td>
  <td class="day-future">15</td>
  <td class="day-future">16</td>
  <td class="day-future">17</td>
  <td class="day-future">18</td>
  <td class="day-future">19</td>
 </tr>
 <tr class="row-week">
  <td class="day-future">20</td>
  <td class="day-future">21</td>
  <td class="day-future">22</td>
  <td class="day-future">23</td>
  <td class="day-future">24</td>
  <td class="day-future">25</td>
  <td class="day-future">26</td>
 </tr>
 <tr class="row-week">
  <td class="day-future">27</td>
  <td class="day-future">28</td>
  <td class="day-future">29</td>
  <td class="day-future">30</td>
  <td class="day-future">31</td>
  <td class="day-blank" colspan="2">&nbsp;</td>
 </tr>
</table></div>


		    </div></div></div>
<div class="block block-node" id="block-node-0">
<div class="pgSideNav">    <h2>Syndication</h2>    
		    <div>
			<div class="xml-icon"><a href="index9637.html?q=rss.xml"><img src="misc/xml.png" width="36" height="14" alt="Flux XML" title="Flux XML" /></a></div>
		    </div></div></div>
<div class="block block-poll" id="block-poll-0">
<div class="pgSideNav">    <h2>Sondage</h2>    
		    <div>
			<div class="poll"><div class="title">Quelle est la version de PostgreSQL la plus r√©pandue sur vos serveurs ?</div><div class="text">8.3</div><div class="bar"><div style="width: 10%;" class="foreground"></div></div><div class="percent">10%</div><div class="text">8.2</div><div class="bar"><div style="width: 42%;" class="foreground"></div></div><div class="percent">42%</div><div class="text">8.1</div><div class="bar"><div style="width: 40%;" class="foreground"></div></div><div class="percent">40%</div><div class="text">8.0</div><div class="bar"><div style="width: 2%;" class="foreground"></div></div><div class="percent">2%</div><div class="text">7.4</div><div class="bar"><div style="width: 6%;" class="foreground"></div></div><div class="percent">6%</div><div class="text">7.3 ou ant√©rieure</div><div class="bar"><div style="width: 0%;" class="foreground"></div></div><div class="percent">0%</div><div class="total">Nombre de votes: 48</div></div><div class="links"><a href="index8c57.html?q=node/1426#comment" title="Sauter au premier commentaire de ce message.">3 commentaires</a> | <a href="index729f.html?q=poll" title="Voir la liste des sondages de ce site.">anciens sondages</a></div>
		    </div></div></div>
    </td>

      <td style="vertical-align: top; width: 80%"><div class="breadcrumb"><a href="index03d2.html?q=">Accueil</a> &raquo; <a href="index79b7.html?q=forum">forums</a> &raquo; <a href="index0561.html?q=forum/10">Technique - g√©n√©ral</a></div><h2 class="title">Probl√®me de partitionnement</h2>
<!-- begin content -->

<!-- node: "Probl√®me de partitionnement" -->
<!--<div class="pgFrontCenterUser">
<div class="pgFrontUser">
<div class="pgFrontUserInner">
--><div class="pgFrontUserWrap">
 <div class="pgFrontUserContent">	<h1 class="plop"><a href="indexea60.html?q=taxonomy/term/10">Technique - g√©n√©ral</a> | <a href="indexaac1.html?q=node/1445" class="active">Probl√®me de partitionnement</a></h1>
		    <p>
			    Par <a href="index837c.html?q=user/2910" title="Voir le profil utilisateur.">Psycho</a> le 01/11/2007 - 00:30
		    </p>	
			    <p>Bonjour,</p>
<p> Je cr√©√© actuellement un syst√®me repr√©sentant les cases d'un monde. Selon nos calculs, la table devrait contenir plus de 25.000.000 de records au d√©part (pour quelques 4 GO) et grandir petit √† petit.<br />
Apr√®s avoir regarder le forum, j'ai vu que la solution du partionnement semblait √™tre une bonne chose √† faire.</p>
<p>J'ai donc d√©couper ma carte en 25 tables diff√©rents (plus facile, carte 5000 x 5000 d√©coup√© en 25 zone de 1000 x 1000, en gros, 1.000.000 de record par table).</p>
<p> J'ai voulu faire un peu des tests sur ca, j'ai donc remplit mes tables avec les deux fa√ßon diff√©rente.<br />
Une solution avec partitionnement et une sans.</p>
<p>1) Premi√®re constatation, le replissage de la partie avec partitionnement m'as pris... beaucoup beaucoup plus de temps (12h contre 4h environ).<br />
A la rigueur, le probl√®me ne me g√®ne pas plus que ca car les tables seront acc√©d√© principalement par SELECT.</p>
<p>2) Ensuite j'ai fais mes test de SELECT sur les table... et fort malheureusement, le SELECT sur les tables partitionn√©s prend plus de temps aussi dans la plupart des cas.</p>
<p>J'ai essayer de faire un EXPLAIN, et il semble que la clause constraint_exception ne soit pas pris en compte (j'ai mis ON dans le fichier postgres.conf et j'ai m√™me v√©rifier en faisant SET constraint_exception = on avant ma requ√™te).<br />
Je suppose que si j'arrive √† ce qu'il prenne en compte ce param√®tre, ma solution avec partitionnement sera meilleur, mais pour l'instant... non.</p>
<p>(au passage, si vous avez des conseils de configuration pour ce genre de donn√©e, taille des buffers et autre, j'avoue ne pas m'y conna√Ætre encore beaucoup l√† dedans, je monte en comp√©tence doucement...)</p>
<p>Les test fait, avec deux requ√™tes :<br />
EXPLAIN ANALYZE SELECT *<br />
FROM monde<br />
WHERE x BETWEEN -1600 AND -1400<br />
AND y BETWEEN 400 AND 600;<br />
(cette requ√™te va obliger le syst√®me avec partitionnement √† aller chercher dans deux tables diff√©rentes)</p>
<p>Sans partitionnement :<br />
1√®re ex√©cution : Total runtime: 40537.848 ms<br />
2i√®me ex√©cution : Total runtime: 191.484 ms</p>
<p>Avec partitionnement :<br />
1√®re ex√©cution : Total runtime: 32166.446 ms<br />
2i√®me ex√©cution : Total runtime: 230.970 ms</p>
<p>EXPLAIN ANALYZE SELECT * FROM monde_test<br />
WHERE x BETWEEN -1800 AND -1600<br />
AND y BETWEEN -200 AND 0;<br />
(la rechercher sera uniquement dans une seul table)</p>
<p>Sans partitionnement :<br />
1√®re ex√©cution : Total runtime : 40735.029 ms (un petit peu moins en fait, j'ai pris le mauvais chiffre)<br />
2i√®me ex√©cution : Total runtime: 192.634 ms</p>
<p>Avec partitionnement :<br />
1√®re ex√©cution : Total runtime: 32196.732 ms<br />
2i√®me ex√©cution : Total runtime: 216.911 ms</p>
<p>Le EXPLAIN ANALYZE (pour la premi√®re requete)</p>
<p>Sans partitionnement :<br />
QUERY PLAN</p>
<p>Bitmap Heap Scan on monde_test  (cost=37841.43..131175.92 rows=40494 width=18) (actual time=173.803..186.790 rows=40401 loops=1)<br />
  Recheck Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
  ->  Bitmap Index Scan on monde_test_pkey  (cost=0.00..37831.30 rows=40494 width=0) (actual time=173.659..173.659 rows=40401 loops=1)<br />
        Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))</p>
<p>Total runtime: 191.484 ms</p>
<p>Avec partitionnement :<br />
QUERY PLAN</p>
<p>Result  (cost=0.00..78658.27 rows=35415 width=18) (actual time=0.212..224.933 rows=40401 loops=1)<br />
  ->  Append  (cost=0.00..78658.27 rows=35415 width=18) (actual time=0.210..205.276 rows=40401 loops=1)<br />
        ->  Index Scan using monde_pkey on monde  (cost=0.00..36677.99 rows=15754 width=18) (actual time=0.210..59.137 rows=20100 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_m2p2_pkey on monde_m2p2 monde  (cost=0.00..3388.55 rows=1 width=18) (actual time=16.332..16.332 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_m1p2_pkey on monde_m1p2 monde  (cost=0.00..3217.28 rows=1 width=18) (actual time=17.147..17.147 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_c0p2_pkey on monde_c0p2 monde  (cost=0.00..8.46 rows=1 width=18) (actual time=0.083..0.083 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_p1p2_pkey on monde_p1p2 monde  (cost=0.00..8.46 rows=1 width=18) (actual time=0.062..0.062 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_p2p2_pkey on monde_p2p2 monde  (cost=0.00..8.46 rows=1 width=18) (actual time=0.060..0.060 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_m2p1_pkey on monde_m2p1 monde  (cost=0.00..8.38 rows=1 width=18) (actual time=0.019..0.019 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_m1p1_pkey on monde_m1p1 monde  (cost=0.00..8.38 rows=1 width=18) (actual time=0.018..0.018 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Bitmap Heap Scan on monde_c0p1 monde  (cost=171.52..267.32 rows=25 width=18) (actual time=0.099..0.099 rows=0 loops=1)<br />
              Recheck Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
              ->  Bitmap Index Scan on monde_c0p1_pkey  (cost=0.00..171.51 rows=25 width=0) (actual time=0.097..0.097 rows=0 loops=1)<br />
                    Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_p1p1_pkey on monde_p1p1 monde  (cost=0.00..8.38 rows=1 width=18) (actual time=0.019..0.019 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_p2p1_pkey on monde_p2p1 monde  (cost=0.00..8.38 rows=1 width=18) (actual time=0.018..0.018 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Bitmap Heap Scan on monde_m2c0 monde  (cost=2858.69..9744.68 rows=8989 width=18) (actual time=15.991..19.954 rows=10100 loops=1)<br />
              Recheck Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
              ->  Bitmap Index Scan on monde_m2c0_pkey  (cost=0.00..2856.44 rows=8989 width=0) (actual time=15.909..15.909 rows=10100 loops=1)<br />
                    Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Bitmap Heap Scan on monde_m1c0 monde  (cost=3385.20..10203.41 rows=10625 width=18) (actual time=16.620..20.841 rows=10201 loops=1)<br />
              Recheck Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
              ->  Bitmap Index Scan on monde_m1c0_pkey  (cost=0.00..3382.55 rows=10625 width=0) (actual time=16.566..16.566 rows=10201 loops=1)<br />
                    Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_c0c0_pkey on monde_c0c0 monde  (cost=0.00..8.46 rows=1 width=18) (actual time=0.075..0.075 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_p1c0_pkey on monde_p1c0 monde  (cost=0.00..8.46 rows=1 width=18) (actual time=0.062..0.062 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_p2c0_pkey on monde_p2c0 monde  (cost=0.00..8.46 rows=1 width=18) (actual time=0.062..0.062 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_m2m1_pkey on monde_m2m1 monde  (cost=0.00..3423.90 rows=1 width=18) (actual time=15.608..15.608 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_m1m1_pkey on monde_m1m1 monde  (cost=0.00..3670.22 rows=1 width=18) (actual time=14.538..14.538 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_c0m1_pkey on monde_c0m1 monde  (cost=0.00..8.46 rows=1 width=18) (actual time=0.076..0.076 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_p1m1_pkey on monde_p1m1 monde  (cost=0.00..8.46 rows=1 width=18) (actual time=0.061..0.061 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_p2m1_pkey on monde_p2m1 monde  (cost=0.00..8.46 rows=1 width=18) (actual time=0.060..0.060 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_m2m2_pkey on monde_m2m2 monde  (cost=0.00..3309.03 rows=1 width=18) (actual time=15.785..15.785 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_m1m2_pkey on monde_m1m2 monde  (cost=0.00..4620.84 rows=1 width=18) (actual time=16.625..16.625 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_c0m2_pkey on monde_c0m2 monde  (cost=0.00..8.50 rows=1 width=18) (actual time=0.100..0.100 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_p1m2_pkey on monde_p1m2 monde  (cost=0.00..8.50 rows=1 width=18) (actual time=0.074..0.074 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))<br />
        ->  Index Scan using monde_p2m2_pkey on monde_p2m2 monde  (cost=0.00..8.38 rows=1 width=18) (actual time=0.023..0.023 rows=0 loops=1)<br />
              Index Cond: ((x >= -1600) AND (x <= -1400) AND (y >= 400) AND (y <= 600))</p>
<!--hr /--><div class="contentsLink">[ <a href="index904e.html?q=node/1471" title="placer et ex√©cuter un script">sujet pr√©c√©dent</a> | <a href="indexb5dd.html?q=node/1460" title="probleme de r√©plication">sujet suivant</a> ]</div>
		     </div></div>
<!--</div>
</div>
</div>
</div> -->
<a id="comment"></a>
<form method="post" action="http://drupal.postgresql.fr/?q=comment"><div>
<div class="pgSideNav">    <h2>Options d'affichage des commentaires</h2>    
		    <div>
			<div class="form-item">
 <select name="mode"> <option value="1">A plat - repli√©</option>
 <option value="2">A plat - d√©pli√©</option>
 <option value="3">Par discussions - repli√©</option>
 <option value="4" selected="selected">Par discussions - d√©pli√©</option>
</select>
<select name="order"> <option value="1">Date - r√©cents en premier</option>
 <option value="2" selected="selected">Date - anciens en premier</option>
</select>
<select name="comments_per_page"> <option value="10">10 commentaires par page</option> <option value="30">30 commentaires par page</option> <option value="50" selected="selected">50 commentaires par page</option> <option value="70">70 commentaires par page</option> <option value="90">90 commentaires par page</option></select>
<input type="hidden" name="threshold" value="0" />
 <input type="submit" class="form-submit" name="op" value="Sauvegarder les param√®tres"  />

 <div class="description">S√©lectionnez la m√©thode d'affichage des commentaires que vous pr√©f√©rez, puis cliquez sur "Sauvegarder les param√®tres" pour activer vos changements.</div>
</div>

		    </div></div><input type="hidden" name="edit[nid]" value="1445" />
</div></form><form method="post" action="http://drupal.postgresql.fr/?q=comment"><div>
<input type="hidden" name="edit[nid]" value="1445" />
<a id="comment-2314"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">Il faudrait qu'on ait le sch</h1>
		<p>
		    <b><a href="indexc818.html?q=user/3" title="Voir le profil utilisateur.">Guillaume Lelarge</a></b>/ = 4 Novembre, 2007 - 10:18
		</p>
		<p>
		    <p>Il faudrait qu'on ait le sch√©ma de la base, ou au moins des tables impact√©es par la pemi√®re requ√™te pour pouvoir vous aider.</p>
<p>--<br />
Guillaume Lelarge.<br />
Administrateur de bases de donn√©es<br />
http://dalibo.com - http://dalibo.org</p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div><a id="comment-2315"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">Description des tables</h1>
		<p>
		    <b><a href="index837c.html?q=user/2910" title="Voir le profil utilisateur.">Psycho</a></b>/ = 4 Novembre, 2007 - 18:23
		</p>
		<p>
		    <p>TABLE MONDE	(x,y,z, id_type_case, ponderation, temperature, humidite, altitude);<br />
Cl√© primaire (x,y,z)<br />
Contrainte X entre -2500 et 2500 et y entre -2500 et 2500<br />
Cl√© √©trang√®re sur id_type_case (non utilis√© dans mes requ√™tes)</p>
<p>Apr√®s, d√©coupage de cette table en 25 tables ayant pour contrainte √† chaque fois environ 1000 x 1000 cases.<br />
Exemple, la table du centre MONDE_c0c0 aura comme contrainte X entre -500 et 500 (pareil pour Y).</p>
<p>(voir image pour plus de pr√©cision : <a href="http://aluvia.game-host.org/images/Aluvia_partitionnementMap.png">Image explication</a>)</p>
<p>J'ai donc une contrainte pour chaque table et une r√®gle par table sur insertion sur la table MONDE qui effectue l'insertion dans la bonne "sous-table" en fonction d'une contrainte.<br />
La contrainte √©tant exactement la m√™me que celle de la table.<br />
(j'ai donc 25 r√®gles √©galement)</p>
<p>Au passage, c'est pour le partitionnement, sans partitionnement c'est tout dans la table MONDE.</p>
<p>---</p>
<p>Les tables impact√©es par la premi√®re requ√™tes sont donc :<br />
MONDE_m2c0, MONDE_m1c0, MONDE_m1p1 et MONDE_m2p1</p>
<p>Et je m'aper√ßoit que je ne comprend pas cette ligne :<br />
-> Bitmap Heap Scan on monde_c0p1 monde (cost=171.52..267.32 rows=25 width=18) (actual time=0.099..0.099 rows=0 loops=1)<br />
 Je comprend pas pourquoi ca va chercher dans cette table.<br />
Et je ne vois pas trop d'acc√®s √† MONDE_m1p1 et MONDE_m2p1</p>
<p>Table impact√©e par la deuxi√®me requ√™te :<br />
MONDE_m2c0</p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div><a id="comment-2904"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">Relance</h1>
		<p>
		    <b><a href="index837c.html?q=user/2910" title="Voir le profil utilisateur.">Psycho</a></b>/ = 12 Novembre, 2007 - 16:06
		</p>
		<p>
		    <p>D√©sol√© d'insister mais je n'ai toujours pas r√©solu mon probl√®me, est-ce qu'ils vous manquent des informations pour "diagnostiquer" ?</p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div><a id="comment-2909"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">Je ne compreds pas tout..</h1>
		<p>
		    <b><a href="indexec55.html?q=user/2" title="Voir le profil utilisateur.">Jean-Paul Argudo</a></b>/ = 13 Novembre, 2007 - 15:14
		</p>
		<p>
		    <p>Bonjour,</p>
<p>Plusieurs questions me viennent √† l'esprit:
<ul>
<li>La table ma√Ætre (ou m√®re) ne doit contenir que:
<ul>
<li>les colonnes de la table
<li>les rules d'insertion dans les bonnes sous-tables</ul>
<p>C'est √† dire qu'absolument *tout* le reste *doit* se trouver sur les tables "filles" (index, cl√©s primaires, √©trang√®res, contraintes).<br />
Est-ce bien le cas?</p>
<li>que donne un <code>select count(*) from only monde</code>? Cette requ√™te retourne le nombre d'enregistrements √©ventuellement contenus (√† tort!: soit on ne l'a pas vid√©e, soit les rules sont d√©faillantes et ne pr√©voient pas tous les cas...) dans la table m√®re.
<li>il s'agit de <code>constraint_exclusion</code>.<br />
Pour √™tre absolument certain que vous avez le bon param√©trage, merci de requ√™ter directement <code>pg_settings</code> comme suit:<br />
<code>select setting from pg_settings</code><br />
<code>where name='constraint_exclusion';</code><br />
Pouvez-vous m'assurer que vous aviez bien <code>on</code> en r√©sultat √† cette requ√™te?</p>
<li>Avez-vous lanc√© un <code>ANALYZE</code> suite √† votre partitionnement pour mettre √† jour les "donn√©es" de l'optimiseur? Si non, faites-le, et relancez vos tests.
<li>Il se peut que ces contre-performances soient explicables par un mauvais param√©trage de PostgreSQL. Merci de nous donner des informations essentielles comme:
<ul>
<li>la version de PostgreSQL utilis√©e
<li>le syst√®me d'exploitation utilis√©
<li>tous les param√®tres <b>non comment√©s</b> de votre fichier <code>postgresql.conf</code></ul>
<li>Enfin, il me faudrait le code complet <code>SQL</code> de la table <code>MONDE</code> ainsi que d'une sous-table de <code>MONDE</code>. Vous pouvez obtenir cela tr√®s facilement avec la commande:<br />
<code>pg_dump --schema-only mabase > monscript.sql</code>.<br />
Editez ensuite <code>monscript.sql</code> pour isoler les ordres SQL dont j'ai besoin pour vous r√©pondre en d√©tails.(soit <code>create table, index, sequences, rules, triggers, contraintes, etc..</code>)
</ul>
<p>Merci :)</p>
<p>--<br />
Jean-Paul ARGUDO<br />
<a href="http://dalibo.com/" title="dalibo - L'expertise PostgreSQL">http://dalibo.com</a> | <a href="http://dalibo.org/" title="dalibo - projets Open-Source">http://dalibo.org</a>
</p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div><a id="comment-4681"></a>
<div class="pgContentWrap"><h1 id="txtFrontFeatureHeading">Nous sommes bien d'accord sur</h1>
		<p>
		    <b><a href="index837c.html?q=user/2910" title="Voir le profil utilisateur.">Psycho</a></b>/ = 21 Novembre, 2007 - 19:42
		</p>
		<p>
		    <p>Nous sommes bien d'accord sur les contraintes, cl√©s, etc...</p>
<p>Je me suis refait une base un peu plus propre que je suis en train de remplir √† nouveau (j'ai enlever les cl√©s √©trang√®re et contrainte de table pour acc√©l√©rer les insertions)</p>
<p>Il faut que je refasse des tests</p>
<p>Voil√† une partie du schema de la base : <a href="http://transfert.aluvia.game-host.org/partitionnement.sql" >Fichier SQL</a></p>
<p>- La table monde est bien vide, aucun probl√®me<br />
- contraint_exclusion est bien √† On</p>
<p>- Pour ce qui est du ANAlYZE, non je ne l'avais pas fait, j'avais fait un VACUUM. J'avoue avoir des probl√®mes pour bien comprendre la diff√©rence entre les deux.<br />
Au passage, sur ma nouvelle base, le ANALYZE me donne pas des r√©sultats incorrect de nombre d'enregistrement tandis ce que le VACUUM si.<br />
(mais probl√®me avec le VACUUM :<br />
<i>NOTICE:  number of page slots needed (191776) exceeds max_fsm_pages (20000)<br />
HINT:  Consider increasing the configuration parameter "max_fsm_pages" to a value over 191776.<br />
VACUUM</i>)</p>
<p>- Pour la configuration de Postgres, j'utilise un package d'installation : <a href="http://www.entropy.ch/software/macosx/postgresql/"> Entropy </a><br />
Et j'avoue ne pas avoir (encore) les connaissances suffisante pour modifier la configuration...</p>
<p>Je vous transmet les configs actuelle :</p>
<p>max_connections = 20			# (change requires restart) <i><-  il va falloir que je monte cette valeur pour plus tard</i><br />
shared_buffers = 2400kB			# min 128kB or max_connections*16kB<br />
max_fsm_pages = 20000		# min max_fsm_relations*16, 6 bytes each<br />
constraint_exclusion = on<br />
datestyle = 'iso, mdy'<br />
lc_monetary = 'C'			# locale for monetary formatting<br />
lc_numeric = 'C'			# locale for number formatting<br />
lc_time = 'C'				# locale for time formatting</p>
<p>- Syst√®me d'exploitation, je fais mes test sous Mac Os X 10.4 mais le but final est sur un Mac Os X Server 10.4 (je ne peut pas me permettre de faire les test sur le serveur de production).<br />
- Postgres 8.2.3</p>
<p>Le serveur de production n'est pas une grosse machines, ce n'est pas un serveur √† la base d'ailleurs<br />
Vitesse du processeur 733 MHz<br />
Mod√®le de l¬íordinateur Power Mac G4<br />
M√©moire 1 Go<br />
Nombre de processeurs 1<br />
Disque dur 60 Go (1 disque)</p>
<p>De toute fa√ßon, vu les quantit√©s de donn√©es (+de 25 millions de records), cela vous semble t'il judicieux de faire un partitionnement ?<br />
Il y a t'il des configurations un peu particuli√®re que je doivent faire ?</p>
<p>Autre petite question annexe,<br />
Si je monte mon nombre de connexion √† 80 ou 100, faut il que je fasse attention √† certaine choses ?<br />
Sachant que je vais d√©sormais utilis√© les connexions persistantes (ce que je ne fesait pas avant) donc je ne sais pas si c'est utile.</p>
<p>Merci √† vous.</p>
<br /><!--hr /--><div class="contentsLink">[ Vous devez <a href="index7992.html?q=user/login">vous connecter</a> pour poster des commentaires ]</div>
		</p></div></div></form>
<!-- end content -->
              </td>

    </tr>
    <tr><td colspan="2">

		<div class="pgTopNav">
		   <div class="pgTopNavLeft"> 
		     <img src="layout/images/nav_lft.png" width="7" height="23" alt="" />
		   </div>
		   <div class="pgTopNavRight">
		    <img src="layout/images/nav_rgt.png" width="7" height="23" alt="" />
		  </div>
		  <!--<ul class="pgTopNavList">-->
		  <ul class="pgTopNavList">
		   <li><a href="index03d2.html?q=" title="Retourner √† la page principale.">accueil</a> </li>
		   <li> <a href="indexf6e5.html?q=archive" title="Lire le contenu plus ancien dans notre archive.">archives</a> </li>
		   <li> <a href="index71c4.html?q=blog" title="Lire les blogues les plus r√©cents.">blogues</a> </li>

		   <li> <a href="indexf6fe.html?q=book" title="Lire et contribuer aux livres collaboratifs.">livres</a> </li>
		   <li> <a href="index79b7.html?q=forum">forums</a> </li>
		   <li> <a href="index729f.html?q=poll" title="Voir la liste des sondages de ce site.">sondages</a> </li>
		   <li> <a href="index4404.html?q=search" title="Chercher pour du contenu plus vieux.">recherche</a></li><li><a href="http://docs.postgresqlfr.org/" target="_blank">documentation </a></li>

		  </ul>

<!--
		   <li><a href="?q=" title="Retourner √† la page principale.">accueil</a> </li>
		   <li> <a href="?q=archive" title="Lire le contenu plus ancien dans notre archive.">archives</a> </li>
		   <li> <a href="?q=blog" title="Lire les blogues les plus r√©cents.">blogues</a> </li>
		   <li> <a href="?q=book" title="Lire et contribuer aux livres collaboratifs.">livres</a> </li>
		   <li> <a href="?q=forum">forums</a> </li>
		   <li> <a href="?q=poll" title="Voir la liste des sondages de ce site.">sondages</a> </li>
		   <li> <a href="?q=search" title="Chercher pour du contenu plus vieux.">recherche</a></li><li><a href="http://docs.postgresqlfr.org/" target="_blank">documentation </a></li>
-->
		  </ul>
	        </div>
    </td></tr>
   </table>
   <p style="text-align: center;">&copy;&nbsp;PostgreSQLFr, tous droits r√©serv√©s.<br>
Site d√©clar√© √† la CNIL sous le num√©ro 1074678, conform√©ment √† la Loi en vigueur.
</p>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-3921927-1");
pageTracker._initData();
pageTracker._trackPageview();
</script>
<p></p>
   
</body>

<!-- Mirrored from drupal.postgresql.fr/?q=node/1445 by HTTrack Website Copier/3.x [XR&CO'2006], Sun, 12 Oct 2008 16:41:52 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>